<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Log - Tech &amp; Posts</title><meta name="Description" content=""><meta property="og:title" content="Log" />
<meta property="og:description" content="网络设备、系统及服务程序等，在运作时都会产生一个叫log的事件记录，每一行日志都记载着日期、时间、使用者及动作等相关操作的描述。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://2phangx-dylan.github.io/posts/log/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-07T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-06-24T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Log"/>
<meta name="twitter:description" content="网络设备、系统及服务程序等，在运作时都会产生一个叫log的事件记录，每一行日志都记载着日期、时间、使用者及动作等相关操作的描述。"/>
<meta name="application-name" content="MyBlog">
<meta name="apple-mobile-web-app-title" content="MyBlog"><link rel="icon" href="/code-slash.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://2phangx-dylan.github.io/posts/log/" /><link rel="prev" href="https://2phangx-dylan.github.io/posts/jwt_tutorial/" /><link rel="next" href="https://2phangx-dylan.github.io/posts/hugo_blog/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Log",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/2phangx-dylan.github.io\/posts\/log\/"
        },"genre": "posts","keywords": "Log","wordcount":  3055 ,
        "url": "https:\/\/2phangx-dylan.github.io\/posts\/log\/","datePublished": "2020-03-07T00:00:00+00:00","dateModified": "2021-06-24T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "2phangx-dylan"},"author": {
                "@type": "Person",
                "name": "2phangx-dylan"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : '' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Tech &amp; Posts"><span class="header-title-pre"><div style='font-family: My Cascadia Code; display: inline-block;'></span>2phangx-dylan<span class="header-title-post"></div></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
	
	<script>
		(function(){
			if(''){
				if (prompt('Please enter password.') !== ''){
					window.stop();
					alert('Sorry! Password wrong.');
					history.back();
				}
			}
		})();
	</script>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Tech &amp; Posts"><span class="header-title-pre"><div style='font-family: My Cascadia Code; display: inline-block;'></span>2phangx-dylan<span class="header-title-post"></div></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Log</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>2phangx-dylan</a></span>&nbsp;<span class="post-category">included in <a href="/categories/java/"><i class="far fa-folder fa-fw"></i>Java</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2020-03-07">2020-03-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;3055 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;15 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#日志实现">日志实现</a></li>
    <li><a href="#日志门面">日志门面</a></li>
    <li><a href="#日志实现jul">日志实现JUL</a>
      <ul>
        <li><a href="#1框架结构">1.框架结构</a></li>
        <li><a href="#2入门案例">2.入门案例</a></li>
        <li><a href="#3日志级别">3.日志级别</a></li>
        <li><a href="#4自定义配置">4.自定义配置</a></li>
        <li><a href="#5占位符相关">5.占位符相关</a></li>
        <li><a href="#6过滤器配置">6.过滤器配置</a></li>
        <li><a href="#7完整的配置文件">7.完整的配置文件</a></li>
      </ul>
    </li>
    <li><a href="#日志实现log4j">日志实现Log4j</a>
      <ul>
        <li><a href="#1入门案例">1.入门案例</a></li>
        <li><a href="#2日志级别">2.日志级别</a></li>
        <li><a href="#3相关组件">3.相关组件</a></li>
        <li><a href="#4自定义配置-1">4.自定义配置</a></li>
        <li><a href="#5完整的配置文件示例">5.完整的配置文件示例</a></li>
      </ul>
    </li>
    <li><a href="#日志门面jcl">日志门面JCL</a>
      <ul>
        <li><a href="#1日志级别">1.日志级别</a></li>
        <li><a href="#2入门案例-1">2.入门案例</a></li>
      </ul>
    </li>
    <li><a href="#日志门面slf4j">日志门面Slf4j</a>
      <ul>
        <li><a href="#1日志级别-1">1.日志级别</a></li>
        <li><a href="#2入门案例-2">2.入门案例</a></li>
        <li><a href="#3绑定日志实现">3.绑定日志实现</a></li>
        <li><a href="#4桥接旧的日志实现">4.桥接旧的日志实现</a></li>
      </ul>
    </li>
    <li><a href="#日志实现logback">日志实现Logback</a>
      <ul>
        <li><a href="#1日志级别-2">1.日志级别</a></li>
        <li><a href="#2入门案例-3">2.入门案例</a></li>
        <li><a href="#3logback组件">3.logback组件</a></li>
        <li><a href="#4配置文件">4.配置文件</a></li>
        <li><a href="#5异步日志">5.异步日志</a></li>
        <li><a href="#6log-access模块">6.log-access模块</a></li>
      </ul>
    </li>
    <li><a href="#日志实现log4j2">日志实现Log4j2</a>
      <ul>
        <li><a href="#1日志级别-3">1.日志级别</a></li>
        <li><a href="#2入门案例-4">2.入门案例</a></li>
        <li><a href="#3配置文件">3.配置文件</a></li>
        <li><a href="#4异步日志">4.异步日志</a></li>
        <li><a href="#5无垃圾记录模式">5.无垃圾记录模式</a></li>
      </ul>
    </li>
    <li><a href="#springboot中的日志实现">SpringBoot中的日志实现</a>
      <ul>
        <li><a href="#1入门案例-1">1.入门案例</a></li>
        <li><a href="#2配置文件">2.配置文件</a></li>
        <li><a href="#3默认配置文件">3.默认配置文件</a></li>
        <li><a href="#4替换logback">4.替换logback</a></li>
        <li><a href="#5注意事项">5.注意事项</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="日志实现">日志实现</h2>
<p>日志实现可以理解为平时所使用的日志系统或日志框架，常见的日志实现，有<strong>JUL</strong>、<strong>log4j</strong>、<strong>logback</strong>、<strong>log4j2</strong>等等。</p>
<p>日志实现通常由于其架构不一致，导致其使用规则或方式也不太一样，日志等级划分也会有所区别。</p>
<p>简而言之，不同的日志实现拥有不一样的<strong>API</strong>，因此获取的日志记录对象是不一样的，获取方式也是不一样的。</p>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Tip<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>多数日志实现所获取的对应日志记录对象都是<strong>Logger</strong>对象，但需要明确一点，这些<strong>Logger</strong>对象的实现是不一样的，它们都是各自日志实现中所编写的<strong>Logger</strong>类，它们并不是同一个类。</p>
<p>如果希望在同一个类中，调用多个不同日志实现提供的<strong>Logger</strong>对象，请使用<strong>Logger</strong>的全限定类名。</p>
</div>
        </div>
    </div>
<hr>
<h2 id="日志门面">日志门面</h2>
<p>当我们的系统变的更加复杂的时候，我们的日志就容易发生混乱。随着系统开发的进行，可能会更新不同的日志实现，造成当系统中存在不同的日志依赖，让我们难以统一的管理和控制。</p>
<p>就算我们强制要求所有的模块使用相同的日志实现，系统中也难以避免使用其他类似<strong>spring</strong>、<strong>mybatis</strong>等其他的第三方框架，它们依赖于我们规定不同的日志实现，而且他们自身的日志系统就有着不一致性，依然会出来日志体系的混乱。</p>
<p>所以我们需要借鉴<strong>JDBC</strong>的思想，为日志框架提供一个统一的门面框架。借此我们就可以面向这些门面框架的接口规范来开发，避免了直接依赖具体的日志实现。</p>
<p>常见的日志门面：</p>
<ul>
<li><strong>JCL（Jakarta Commons Logging）</strong></li>
<li><strong>slf4j（Simple Logging Facade for Java）</strong></li>
</ul>
<p>常见的日志实现：</p>
<ul>
<li><strong>JUL（Java Util Logging）</strong></li>
<li><strong>log4j（Log for Java）</strong></li>
<li><strong>logback</strong></li>
<li><strong>log4j2（Log for Java 2）</strong></li>
<li><strong>slf4j-simple</strong></li>
</ul>
<p>日志实现或门面的出现顺序：</p>
<div class="mermaid" id="id-1"></div>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Tip<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">关于日志实现<strong>slf4j-simple</strong>，它是随着日志门面<strong>slf4j</strong>而出现的日志实现，功能较为简单，并不是本文的重点。</div>
        </div>
    </div>
<hr>
<h2 id="日志实现jul">日志实现JUL</h2>
<p><strong>JUL</strong>全称<strong>Java Util Logging</strong>，是<strong>Java</strong>原生的日志实现，使用时不需要另外引入第三方类库，相对于其他日志实现来说其特点是使用方便，能够在小型应用中灵活应用。</p>
<p><strong>JUL</strong>日志实现使用的频率并不高，但一旦需要接触此类的代码，仍然要求开发人员能够迅速看懂代码，并理解。</p>
<h3 id="1框架结构">1.框架结构</h3>
<p><strong>JUL</strong>包括了三部分组件，分别是<strong>Logger</strong>、<strong>Appender</strong>和<strong>Filter</strong>，其中<strong>Appender</strong>也被称为<strong>Handler</strong>。</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201130183326188.png" title="/images/Log.images/image-20201130183326188.png" data-thumbnail="/images/Log.images/image-20201130183326188.png" data-sub-html="<h2>JUL Framework</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201130183326188.png"
            data-srcset="/images/Log.images/image-20201130183326188.png, /images/Log.images/image-20201130183326188.png 1.5x, /images/Log.images/image-20201130183326188.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201130183326188.png" width="100%" />
    </a><figcaption class="image-caption"><strong>JUL Framework</strong></figcaption>
    </figure>
<p><strong>Loggers</strong>被称为记录器，应用程序通过获取<strong>Logger</strong>对象，调用其<strong>API</strong>来发布日志信息，<strong>Logger</strong>通常是应用程序访问日志系统的入口程序。</p>
<p><strong>Appenders</strong>也被称为<strong>Handlers</strong>，每个<strong>Logger</strong>都会关联一组<strong>Handlers</strong>，<strong>Logger</strong>会将日志交给关联的<strong>Handlers</strong>处理，由<strong>Handlers</strong>负责将日志记录。</p>
<p><strong>Handlers</strong>实际是一个抽象类，代码中总是由其具体的实现来决定日志记录的最终输出位置是控制台、文件、网络上的其他日志服务异或是操作系统日志。</p>
<p><strong>Filters</strong>则是过滤器，根据需要定制哪些信息会被记录，哪些信息会被忽略。</p>
<p><strong>JUL</strong>配置文件中，会涉及到另外两个关键设置，即<strong>Layouts</strong>和<strong>Level</strong>。<strong>Layouts</strong>也被称为<strong>Formatters</strong>，它负责对日志事件中的数据进行转换和格式化，<strong>Layouts</strong>决定了记录的数据在一条日志记录中的最终显示形式。</p>
<p><strong>Level</strong>即日志级别，每条日志消息都有一个关联的日志级别。该级别粗略指导了日志消息的重要性和紧迫，可以将<strong>Level</strong>与<strong>Loggers</strong>、<strong>Appenders</strong>做关联，以对日志消息进行筛选。</p>
<p>一个完整的日志记录过程如下：</p>
<ol>
<li>用户使用<strong>Logger</strong>来进行日志记录的行为，<strong>Logger</strong>可以同时持有若干个<strong>Handler</strong>，日志输出操作是由<strong>Handler</strong>完成的；</li>
<li>在<strong>Handler</strong>输出日志前，会经过<strong>Filter</strong>的过滤，判断哪些日志级别放行、哪些拦截，<strong>Handler</strong>会将日志内容输出到指定位置（日志文件、控制台等）；</li>
<li><strong>Handler</strong>在输出日志时会使用<strong>Layout</strong>对日志内容进行排版，之后再输出到指定的位置。</li>
</ol>
<h3 id="2入门案例">2.入门案例</h3>
<p>入门案例为简单的日志输出过程。所有的日志在无配置文件的情况下，使用<strong>ConsoleHandler</strong>控制台输出日志。简而言之，日志会在控制台进行显示，而非输出到日志文件或其他位置。</p>
<p>以下是入门案例的示例代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 1.创建JUL Logger对象无法传入class对象，迂回战术可以获取该类之后获取名字
</span><span class="c1"></span>    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">JulTest</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

    <span class="c1">// 2.输出日志的两种方式，其中日志级别共有7种，还有2种特殊级别
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Hello, here is Java Util Logging&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="s">&#34;You can also use this way to output log.&#34;</span><span class="o">);</span>

    <span class="c1">// 3.尽量不采用拼接字符串的形式，采用占位符的形式，占位符中需要填写索引编号
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;dylan&#34;</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="n">12</span><span class="o">;</span>

    <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="s">&#34;[USER]:{0} [AGE]:{1}&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[]{</span><span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">});</span>
<span class="o">}</span>
</code></pre></div><h3 id="3日志级别">3.日志级别</h3>
<p><strong>JUL</strong>内置了<strong>7</strong>种基础的日志级别和<strong>2</strong>种特殊的日志级别。</p>
<p><strong>7</strong>种基础的日志级别为：</p>
<ol>
<li><strong>SEVERE</strong>（最高等级）</li>
<li><strong>WARNING</strong></li>
<li><strong>INFO</strong>（默认等级）</li>
<li><strong>CONFIG</strong></li>
<li><strong>FINE</strong></li>
<li><strong>FINER</strong></li>
<li><strong>FINEST</strong>（最低等级）</li>
</ol>
<p><strong>2</strong>种特殊的日志级别，主要用于开关日志：</p>
<ol>
<li><strong>OFF</strong>：用于关闭日志记录；</li>
<li><strong>ALL</strong>：用于启用日志记录。</li>
</ol>
<p>采用示例的方式，展示<strong>7</strong>种基础的日志级别：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * JUL默认的日志级别是Info，所有级别高于等于Info的日志都会被输出控制台。
</span><span class="cm"> */</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testLogLevel</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 1.获取日志记录器对象，其中getLogger的参数name是此日志对象Logger的名称，可以由logger.getName()取出
</span><span class="c1"></span>    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.dylanphang.jul.JulTest&#34;</span><span class="o">);</span>

    <span class="c1">// 2.使用默认的ConsoleHandler输出各级别的日志，默认情况下只有Server、Warning和Info会输出到控制台
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&#34;Level Severe.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">warning</span><span class="o">(</span><span class="s">&#34;Level Warning.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Level Info.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">config</span><span class="o">(</span><span class="s">&#34;Level Config.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">fine</span><span class="o">(</span><span class="s">&#34;Level Fine.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">finer</span><span class="o">(</span><span class="s">&#34;Level Finer.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">finest</span><span class="o">(</span><span class="s">&#34;Level Finest&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>示例代码运行输出如下：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230005650057.png" title="/images/Log.images/image-20201230005650057.png" data-thumbnail="/images/Log.images/image-20201230005650057.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230005650057.png"
            data-srcset="/images/Log.images/image-20201230005650057.png, /images/Log.images/image-20201230005650057.png 1.5x, /images/Log.images/image-20201230005650057.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230005650057.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>不难留意到，尽管代码中定义了输出<strong>INFO</strong>等级以下的日志，但实际控制台中并没有相关的日志信息，这是因为：</p>
<ul>
<li>默认的日志级别是由<strong>RootLogger</strong>决定的，所有的<strong>Logger</strong>对象默认都会继承并使用<strong>RootLogger</strong>所提供的控制台输出处理器对象<strong>ConsoleHandler</strong>；</li>
<li>同时，<strong>RootLogger</strong>的默认日志输出等级为<strong>INFO</strong>，则所有未经配置的<strong>Logger</strong>默认也是使用该日志级别。</li>
</ul>
<p>考虑采用更为直观的方式，打印当前<strong>Logger</strong>对象的日志等级，及与其关联的处理器对象<strong>Handler</strong>的数量。示例代码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFindDefault</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.dylanphang.jul.JulTest&#34;</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Default Logger&#39;s Level: &#34;</span> <span class="o">+</span> <span class="n">logger</span><span class="o">.</span><span class="na">getLevel</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Default Logger&#39;s Handlers&#39; Quantity: &#34;</span>  <span class="o">+</span> <span class="n">logger</span><span class="o">.</span><span class="na">getHandlers</span><span class="o">().</span><span class="na">length</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>运行得到：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230010242330.png" title="/images/Log.images/image-20201230010242330.png" data-thumbnail="/images/Log.images/image-20201230010242330.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230010242330.png"
            data-srcset="/images/Log.images/image-20201230010242330.png, /images/Log.images/image-20201230010242330.png 1.5x, /images/Log.images/image-20201230010242330.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230010242330.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>这并不意外，默认情况下由于<strong>Logger</strong>继承并使用<strong>RootLogger</strong>中的日志等级与处理器对象，因此对于它自身来说，并不拥有任何的日志等级信息与处理器对象。</p>
<p>同样采用更直观的方式打印当前<strong>Logger</strong>的父日志相关信息。示例代码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testParentLogger</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.dylanphang.jul.JulTest&#34;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">loggerParent</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="na">getParent</span><span class="o">();</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Logger&#39;s Default Parent Logger is: &#34;</span> <span class="o">+</span> <span class="n">loggerParent</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Parent Logger&#39;s Level: &#34;</span> <span class="o">+</span> <span class="n">loggerParent</span><span class="o">.</span><span class="na">getLevel</span><span class="o">());</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Parent Logger&#39;s Handlers&#39; Quantity: &#34;</span> <span class="o">+</span> <span class="n">loggerParent</span><span class="o">.</span><span class="na">getHandlers</span><span class="o">().</span><span class="na">length</span><span class="o">);</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">Handler</span> <span class="n">handler</span> <span class="o">:</span> <span class="n">loggerParent</span><span class="o">.</span><span class="na">getHandlers</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Default &#34;</span> <span class="o">+</span> <span class="n">handler</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;&#39;s Level: &#34;</span> <span class="o">+</span> <span class="n">handler</span><span class="o">.</span><span class="na">getLevel</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>运行得到：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230011229289.png" title="/images/Log.images/image-20201230011229289.png" data-thumbnail="/images/Log.images/image-20201230011229289.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230011229289.png"
            data-srcset="/images/Log.images/image-20201230011229289.png, /images/Log.images/image-20201230011229289.png 1.5x, /images/Log.images/image-20201230011229289.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230011229289.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>至此，不难推断出<strong>Logger</strong>的日志输出等级取决于<strong>RootLogger</strong>。</p>
<p>除此之外，<strong>Logger</strong>和<strong>Handler</strong>的日志等级是相互牵制的，其中等级较高一方的配置生效。</p>
<p>通过更改<strong>RootLogger</strong>中的日志级别及其<strong>ConsoleHandler</strong>的日志级别，观察输出结果。示例代码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testLevel</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 0.准备工作
</span><span class="c1"></span>    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.dylanphang.jul.JulTest&#34;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="na">getParent</span><span class="o">();</span>

    <span class="c1">// 1.RootLogger日志等级高于ConsoleHandler日志等级
</span><span class="c1"></span>    <span class="n">parent</span><span class="o">.</span><span class="na">setLevel</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">WARNING</span><span class="o">);</span>
    <span class="n">parent</span><span class="o">.</span><span class="na">getHandlers</span><span class="o">()[</span><span class="n">0</span><span class="o">].</span><span class="na">setLevel</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">CONFIG</span><span class="o">);</span>

    <span class="n">logger</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&#34;[SEVERE ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">warning</span><span class="o">(</span><span class="s">&#34;[WARNING]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">config</span><span class="o">(</span><span class="s">&#34;[CONFIG ]Something.&#34;</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;=============================================&#34;</span><span class="o">);</span>

    <span class="c1">// 2.RootLogger日志等级小于ConsoleHandler日志等级
</span><span class="c1"></span>    <span class="n">parent</span><span class="o">.</span><span class="na">setLevel</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">FINER</span><span class="o">);</span>

    <span class="n">logger</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&#34;[SEVERE ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">warning</span><span class="o">(</span><span class="s">&#34;[WARNING]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">config</span><span class="o">(</span><span class="s">&#34;[CONFIG ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">fine</span><span class="o">(</span><span class="s">&#34;[FINE   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">finer</span><span class="o">(</span><span class="s">&#34;[FINER  ]Something.&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>运行得到：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230013331578.png" title="/images/Log.images/image-20201230013331578.png" data-thumbnail="/images/Log.images/image-20201230013331578.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230013331578.png"
            data-srcset="/images/Log.images/image-20201230013331578.png, /images/Log.images/image-20201230013331578.png 1.5x, /images/Log.images/image-20201230013331578.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230013331578.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<h3 id="4自定义配置">4.自定义配置</h3>
<p>通常会在单独的配置文件中，集中配置<strong>Logger</strong>的日志等级、处理器类型等信息。</p>
<p>但作为入门，首先可以了解如何在<strong>Java</strong>代码中，更改<strong>Logger</strong>日志级别及配置自定义<strong>ConsoleHandler</strong>。</p>
<p>如果不希望<strong>Logger</strong>对象使用<strong>RootLogger</strong>中的默认日志级别进行输出，则需要对<strong>Logger</strong>进行单独的配置：</p>
<ol>
<li>重新设置<strong>Logger</strong>的日志输出等级；</li>
<li>重新配置<strong>Logger</strong>的处理器<strong>Handler</strong>类型，并不再使用<strong>RootLogger</strong>中提供的默认处理器。</li>
</ol>
<p>示例代码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUserDefined</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 1.获取日志记录器对象
</span><span class="c1"></span>    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.dylanphang.jul.JulTest&#34;</span><span class="o">);</span>

    <span class="c1">// 2.配置Logger使其不再继承使用RootLogger中的所有Handler
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">setUseParentHandlers</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

    <span class="c1">// 3.自定义ConsoleHandler对象，并配置该处理器的日志等级
</span><span class="c1"></span>    <span class="n">ConsoleHandler</span> <span class="n">consoleHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConsoleHandler</span><span class="o">();</span>
    <span class="n">consoleHandler</span><span class="o">.</span><span class="na">setLevel</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">ALL</span><span class="o">);</span>

    <span class="c1">// 4.为Logger添加自定义的ConsoleHandler
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">addHandler</span><span class="o">(</span><span class="n">consoleHandler</span><span class="o">);</span>

    <span class="c1">// 5.由于Logger默认会使用RootLogger的日志等级，如果希望输出Level.ALL的日志，同时需要设置Logger的日志等级也为Level.ALL
</span><span class="c1"></span>    <span class="c1">// *.否则，Logger将会使用RootLogger的默认日志等级INFO，最终日志只会输出等级高于或等于INFO的内容
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">setLevel</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">ALL</span><span class="o">);</span>

    <span class="c1">// 6.分别输出各等级的日志
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&#34;[SEVERE ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">warning</span><span class="o">(</span><span class="s">&#34;[WARNING]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">config</span><span class="o">(</span><span class="s">&#34;[CONFIG ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">fine</span><span class="o">(</span><span class="s">&#34;[FINE   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">finer</span><span class="o">(</span><span class="s">&#34;[FINER  ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">finest</span><span class="o">(</span><span class="s">&#34;[FINEST ]Something.&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>运行得到：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230121122160.png" title="/images/Log.images/image-20201230121122160.png" data-thumbnail="/images/Log.images/image-20201230121122160.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230121122160.png"
            data-srcset="/images/Log.images/image-20201230121122160.png, /images/Log.images/image-20201230121122160.png 1.5x, /images/Log.images/image-20201230121122160.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230121122160.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>开发中较常使用日志配置方式，是通过<strong>logging.properties</strong>文件完成的，示例配置如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># RootLogger的日志级别（默认INFO)，所有的Handler都受限于此日志级别，Handler的日志级别可以比RootLogger的日志级别高</span>
.level<span class="o">=</span>ALL
<span class="c1"># RootLogger默认的处理器，可以配置多个，所有非手动解除父日志的子日志都将使用这些处理器</span>
<span class="nv">handlers</span><span class="o">=</span>java.util.logging.ConsoleHandler, java.util.logging.FileHandler

<span class="c1"># ConsoleHandler控制台输出处理器配置</span>
<span class="c1"># 指定ConsoleHandler默认日志级别</span>
java.util.logging.ConsoleHandler.level<span class="o">=</span>ALL
java.util.logging.ConsoleHandler.encoding<span class="o">=</span>UTF-8

<span class="c1"># FileHandler文件输出处理器配置</span>
<span class="c1"># 指定FileHandler默认日志级别</span>
java.util.logging.FileHandler.level<span class="o">=</span>WARNING
<span class="c1"># 日志文件输出路径</span>
java.util.logging.FileHandler.pattern<span class="o">=</span>/dylan%u.log
<span class="c1"># 单个日志文件大小，单位是bit，1024bit即为1kb</span>
java.util.logging.FileHandler.limit<span class="o">=</span>1024*1024*10
<span class="c1"># 日志文件数量，如果数量为2，则会生成dylan.log.0文件和dylan.log.1文件，总容量为: (limit * count)bit</span>
java.util.logging.FileHandler.count<span class="o">=</span><span class="m">1</span>
<span class="c1"># FileHandler持有的最大并发锁数</span>
java.util.logging.FileHandler.maxLocks<span class="o">=</span><span class="m">100</span>
<span class="c1"># 指定要使用的Formatter类的名称，FileHandler默认使用的是XMLFormatter</span>
java.util.logging.FileHandler.formatter<span class="o">=</span>java.util.logging.SimpleFormatter
<span class="c1"># 涉及中文日志就最好加上编码集</span>
java.util.logging.FileHandler.encoding<span class="o">=</span>UTF-8
<span class="c1"># 是否以追加方式添加日志内容</span>
java.util.logging.FileHandler.append<span class="o">=</span><span class="nb">true</span>
<span class="c1"># SimpleFormatter的输出格式配置</span>
java.util.logging.SimpleFormatter.format<span class="o">=</span>%4<span class="nv">$s</span>: %5<span class="nv">$s</span> <span class="o">[</span>%1<span class="nv">$tc</span><span class="o">]</span>%n

<span class="c1"># 自定义日志级别，其中“cn.hanna”指的是Logger.getLogger(String name)中的显式入参name！！！</span>
cn.hanna.handlers<span class="o">=</span>java.util.logging.ConsoleHandler
cn.hanna.level<span class="o">=</span>INFO
<span class="c1"># 如果此时不关闭名为cn.hanna的Logger的父日志处理器，则在控制台会同时出现父日志处理器和自定义的处理器，消息将重复输出</span>
cn.hanna.useParentHandlers<span class="o">=</span><span class="nb">false</span>
</code></pre></div><p>为测试以上配置文件，可以先构建<strong>Maven</strong>项目，默认情况下，配置文件需要手动加载，过程如下：</p>
<ol>
<li>使用<span id="id-2">getResourceAsStream(String fileName)</span>读取<strong>resource</strong>目录下的配置文件，获取输入流对象<strong>is</strong>；</li>
<li>获取<strong>LogManager</strong>对象，该对象是用于全局配置日志的管理对象，它是单例的，需要使用它来加载应用配置文件；</li>
<li>调用<strong>LogManager</strong>对象中的<span id="id-3">readConfiguration(InputStream is)</span>方法加载输入流对象<strong>is</strong>，<strong>RootLogger</strong>的日志级别和与之关联的<strong>Handler</strong>将自动根据<strong>logging.properties</strong>文件进行配置；</li>
<li>配置文件中特殊命名的<strong>Logger</strong>，将遵循配置文件中设置：使用<strong>ConsoleHandler</strong>、日志等级<strong>INFO</strong>、关闭依赖<strong>RootLogger</strong>的<strong>Handler</strong>。</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUserDefined</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="c1">// 1.读取配置文件
</span><span class="c1"></span>    <span class="kd">final</span> <span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span>
        <span class="n">Jul2Test</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&#34;logging.properties&#34;</span><span class="o">);</span>

    <span class="c1">// 2.获取LogManager，LogManager是单例对象，并加载应用配置文件logging.properties
</span><span class="c1"></span>    <span class="kd">final</span> <span class="n">LogManager</span> <span class="n">logManager</span> <span class="o">=</span> <span class="n">LogManager</span><span class="o">.</span><span class="na">getLogManager</span><span class="o">();</span>
    <span class="n">logManager</span><span class="o">.</span><span class="na">readConfiguration</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>

    <span class="c1">// 4.正常输出日志
</span><span class="c1"></span>    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">loggerNormal</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>

    <span class="n">loggerNormal</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&#34;[SEVERE ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerNormal</span><span class="o">.</span><span class="na">warning</span><span class="o">(</span><span class="s">&#34;[WARNING]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerNormal</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerNormal</span><span class="o">.</span><span class="na">config</span><span class="o">(</span><span class="s">&#34;[CONFIG ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerNormal</span><span class="o">.</span><span class="na">fine</span><span class="o">(</span><span class="s">&#34;[FINE   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerNormal</span><span class="o">.</span><span class="na">finer</span><span class="o">(</span><span class="s">&#34;[FINER  ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerNormal</span><span class="o">.</span><span class="na">finest</span><span class="o">(</span><span class="s">&#34;[FINEST ]Something.&#34;</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;=============================================&#34;</span><span class="o">);</span>

    <span class="c1">// 5.指定日志对象的名称，配置文件中对cn.hanna名称的Logger进行了特殊配置
</span><span class="c1"></span>    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">loggerSpecial</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.hanna&#34;</span><span class="o">);</span>

    <span class="n">loggerSpecial</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&#34;[SEVERE ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerSpecial</span><span class="o">.</span><span class="na">warning</span><span class="o">(</span><span class="s">&#34;[WARNING]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerSpecial</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerSpecial</span><span class="o">.</span><span class="na">config</span><span class="o">(</span><span class="s">&#34;[CONFIG ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerSpecial</span><span class="o">.</span><span class="na">fine</span><span class="o">(</span><span class="s">&#34;[FINE   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerSpecial</span><span class="o">.</span><span class="na">finer</span><span class="o">(</span><span class="s">&#34;[FINER  ]Something.&#34;</span><span class="o">);</span>
    <span class="n">loggerSpecial</span><span class="o">.</span><span class="na">finest</span><span class="o">(</span><span class="s">&#34;[FINEST ]Something.&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>运行测试，控制台输出如下：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230123610536.png" title="/images/Log.images/image-20201230123610536.png" data-thumbnail="/images/Log.images/image-20201230123610536.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230123610536.png"
            data-srcset="/images/Log.images/image-20201230123610536.png, /images/Log.images/image-20201230123610536.png 1.5x, /images/Log.images/image-20201230123610536.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230123610536.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>日志文件<strong>dylan0.log</strong>输出：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230123645148.png" title="/images/Log.images/image-20201230123645148.png" data-thumbnail="/images/Log.images/image-20201230123645148.png" data-sub-html="<h2>dylan0.log</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230123645148.png"
            data-srcset="/images/Log.images/image-20201230123645148.png, /images/Log.images/image-20201230123645148.png 1.5x, /images/Log.images/image-20201230123645148.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230123645148.png" width="100%" />
    </a><figcaption class="image-caption"><strong>dylan0.log</strong></figcaption>
    </figure>
<h3 id="5占位符相关">5.占位符相关</h3>
<p>留意到配置内<strong>formatter</strong>中的包含了相关占位符，如果希望掌握这一部分的含义，需要首先了解<strong>String.format</strong>的使用。</p>
<p>考虑以下代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;Mike&#34;</span><span class="o">;</span>
    <span class="kt">double</span> <span class="n">score</span> <span class="o">=</span> <span class="n">89</span><span class="o">;</span>
    <span class="n">Calendar</span> <span class="n">calendar</span> <span class="o">=</span> <span class="n">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
    <span class="n">calendar</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">1992</span><span class="o">,</span> <span class="n">Calendar</span><span class="o">.</span><span class="na">JANUARY</span><span class="o">,</span> <span class="n">3</span><span class="o">);</span>

    <span class="kd">final</span> <span class="n">String</span> <span class="n">formatA</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;[%1$-5s] %2$tF score: (%3$-8.2f)&#34;</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">calendar</span><span class="o">,</span> <span class="n">score</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">String</span> <span class="n">formatB</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;[%1$-5s] %2$tY-%2$tm-%2$td score: (%3$8.2f)&#34;</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">calendar</span><span class="o">,</span> <span class="n">score</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">formatA</span><span class="o">);</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">formatB</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>运行输出：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230140734745.png" title="/images/Log.images/image-20201230140734745.png" data-thumbnail="/images/Log.images/image-20201230140734745.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230140734745.png"
            data-srcset="/images/Log.images/image-20201230140734745.png, /images/Log.images/image-20201230140734745.png 1.5x, /images/Log.images/image-20201230140734745.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230140734745.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>可以看到，<strong>String.format</strong>可以将数据按照指定的格式转换为<strong>String</strong>类型的数据，其中需要遵循以下规则：</p>
<p><strong>%[argument_index$][flags][width][.precision]conversion</strong></p>
<p>参数说明如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>argument_index$</strong></td>
<td style="text-align:center">格式化参数在<strong>String.format</strong>中的索引位置，从<strong>1</strong>开始计算索引</td>
</tr>
<tr>
<td style="text-align:center"><strong>flags</strong></td>
<td style="text-align:center">关于此格式化数据的额外格式设定，如左对齐<span id="id-4">-</span>、是否显示正负数符号<span id="id-5">+</span></td>
</tr>
<tr>
<td style="text-align:center"><strong>width</strong></td>
<td style="text-align:center">此格式数据所占用的宽度。当宽度大于参数的实际宽度时，会自动将格式化数据右对齐</td>
</tr>
<tr>
<td style="text-align:center"><strong>.precision</strong></td>
<td style="text-align:center">需要格式化的是一个浮点数时，可以自定义该浮点数格式化后所需保留的小数点位数</td>
</tr>
<tr>
<td style="text-align:center"><strong>conversion</strong></td>
<td style="text-align:center">表示需要格式的数据类型是什么</td>
</tr>
</tbody>
</table>
<p>关于<strong>String.format</strong>的详细内容，可以参考<a href="https://docs.oracle.com/javase/7/docs/api/java/util/Formatter.html" target="_blank" rel="noopener noreffer"><strong>Formatter</strong></a>，其中提供了大量的关于各种类型的各种格式化占位符信息。</p>
<p>了解<strong>String.format</strong>后，等同于了解了日志记录的格式化原理了。</p>
<p>日志内部使用的也是<strong>String.format</strong>对日志输出形式进行格式化，其默认调用格式如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-Java" data-lang="Java"><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">format</span><span class="o">,</span> <span class="n">date</span><span class="o">,</span> <span class="n">source</span><span class="o">,</span> <span class="n">logger</span><span class="o">,</span> <span class="n">level</span><span class="o">,</span> <span class="n">message</span><span class="o">,</span> <span class="n">thrown</span><span class="o">);</span>
</code></pre></div><p>参数说明如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>format</strong></td>
<td style="text-align:center"><strong>SimpleFormatter.format</strong>中使用的格式，也是配置文件<strong>logging.properties</strong>中定义的格式</td>
</tr>
<tr>
<td style="text-align:center"><strong>date</strong></td>
<td style="text-align:center">日志的输出日期</td>
</tr>
<tr>
<td style="text-align:center"><strong>source</strong></td>
<td style="text-align:center">日志的调用者，如果不存在则会输出日志对象的名称</td>
</tr>
<tr>
<td style="text-align:center"><strong>logger</strong></td>
<td style="text-align:center">日志对象的名称</td>
</tr>
<tr>
<td style="text-align:center"><strong>level</strong></td>
<td style="text-align:center">日志等级</td>
</tr>
<tr>
<td style="text-align:center"><strong>message</strong></td>
<td style="text-align:center">日志信息</td>
</tr>
<tr>
<td style="text-align:center"><strong>thrown</strong></td>
<td style="text-align:center">当有异常时，会在日志信息中包含异常信息，如果不存在则不输出</td>
</tr>
</tbody>
</table>
<span id="id-6"><p>其中，允许进行自定义配置的部分只有<strong>format</strong>和<strong>message</strong>，而其余参数都是默认提供的。</p>
<p>调用日志框架的代码中，所提供的即为日志信息<strong>message</strong>。而通过配置文件，可以更改<strong>format</strong>的默认格式，即可达到根据个人要求更改日志输出格式的目的。</p>
</span>
<p>关于<strong>SimpleFormatter</strong>的详细内容，可以参考<a href="https://docs.oracle.com/javase/7/docs/api/java/util/logging/SimpleFormatter.html" target="_blank" rel="noopener noreffer"><strong>SimpleFormatter</strong></a>，其中包含了更详细的说明与示例。</p>
<p>初步了解相关原理后，再次审视配置文件中日志格式配置：</p>
<ol>
<li><strong>%4$s</strong>：索引位<strong>4</strong>是<strong>level</strong>，表示日志等级，数据类型是<strong>String</strong>，使用的<strong>conversion</strong>为<strong>s</strong>；</li>
<li><strong>%5$s</strong>：索引位<strong>5</strong>是<strong>message</strong>，表示日志信息，数据类型是<strong>String</strong>，使用的<strong>conversion</strong>为<strong>s</strong>；</li>
<li><strong>%1$tc</strong>：索引位<strong>1</strong>是<strong>date</strong>，表示日志输出日期，数据类型是<strong>Date</strong>，使用的<strong>conversion</strong>为<strong>tc</strong>；</li>
<li><strong>%n</strong>：换行符。</li>
</ol>
<p>当运行代码<strong>logger.warning(&quot;[WARNING]Something.&quot;)</strong>，将得到指定格式的日志记录，如下：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230143803858.png" title="/images/Log.images/image-20201230143803858.png" data-thumbnail="/images/Log.images/image-20201230143803858.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230143803858.png"
            data-srcset="/images/Log.images/image-20201230143803858.png, /images/Log.images/image-20201230143803858.png 1.5x, /images/Log.images/image-20201230143803858.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230143803858.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>此时格式与日志输出格式一致。</p>
<h3 id="6过滤器配置">6.过滤器配置</h3>
<p>关于<strong>Filter</strong>过滤器，了解即可。使用过滤器，需要在代码中使用<strong>Logger</strong>对象中的<strong>setFilter</strong>方法，配置一个<strong>Filter</strong>对象。</p>
<p><strong>Filter</strong>是一个函数式接口，源码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Filter</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * Check if a given log record should be published.
</span><span class="cm">     * @param record  a LogRecord
</span><span class="cm">     * @return true if the log record should be published.
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isLoggable</span><span class="o">(</span><span class="n">LogRecord</span> <span class="n">record</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p><strong>LogRecord</strong>是内部用于获取当前日志消息的对象，<strong>JUL</strong>将使用我们构建的<strong>Filter</strong>对象，进行进一步的判定。</p>
<p><strong>LogRecord</strong>对象中，封装了对应的日志消息，使用方法<span id="id-7">getMessage()</span>即可取出。</p>
<p><strong>Filter</strong>对象中，如果方法<span id="id-8">isLoggable()</span>返回<strong>false</strong>，表示忽略该日志信息；否则，记录日志信息。</p>
<p>测试代码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">InputStream</span> <span class="n">is</span> <span class="o">=</span>
        <span class="n">Jul3Test</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&#34;logging.properties&#34;</span><span class="o">);</span>
    <span class="kd">final</span> <span class="n">LogManager</span> <span class="n">logManager</span> <span class="o">=</span> <span class="n">LogManager</span><span class="o">.</span><span class="na">getLogManager</span><span class="o">();</span>
    <span class="n">logManager</span><span class="o">.</span><span class="na">readConfiguration</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>

    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>

    <span class="n">logger</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&#34;[SEVERE ]Something What.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">warning</span><span class="o">(</span><span class="s">&#34;[WARNING]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">config</span><span class="o">(</span><span class="s">&#34;[CONFIG ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">fine</span><span class="o">(</span><span class="s">&#34;[FINE   ]Something What.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">finer</span><span class="o">(</span><span class="s">&#34;[FINER  ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">finest</span><span class="o">(</span><span class="s">&#34;[FINEST ]Something What.&#34;</span><span class="o">);</span>

    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;=============================================&#34;</span><span class="o">);</span>

    <span class="c1">// *.配置过滤器Filter
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">setFilter</span><span class="o">((</span><span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">x</span><span class="o">.</span><span class="na">getMessage</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;What&#34;</span><span class="o">));</span>

    <span class="n">logger</span><span class="o">.</span><span class="na">severe</span><span class="o">(</span><span class="s">&#34;[SEVERE ]Something What.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">warning</span><span class="o">(</span><span class="s">&#34;[WARNING]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO   ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">config</span><span class="o">(</span><span class="s">&#34;[CONFIG ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">fine</span><span class="o">(</span><span class="s">&#34;[FINE   ]Something What.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">finer</span><span class="o">(</span><span class="s">&#34;[FINER  ]Something.&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">finest</span><span class="o">(</span><span class="s">&#34;[FINEST ]Something What.&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>其中使用<strong>lambda</strong>表达式：<span id="id-9">!record.getMessage().contains(&ldquo;What&rdquo;)</span>。即如果日志记录包含了关键字<strong>What</strong>，则返回<strong>false</strong>，表示过滤该条日志信息，不进行记录操作。</p>
<p>运行输出：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230145010635.png" title="/images/Log.images/image-20201230145010635.png" data-thumbnail="/images/Log.images/image-20201230145010635.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230145010635.png"
            data-srcset="/images/Log.images/image-20201230145010635.png, /images/Log.images/image-20201230145010635.png 1.5x, /images/Log.images/image-20201230145010635.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230145010635.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p><strong>Filter</strong>生效，并成功将包含<strong>What</strong>的日志记录过滤。</p>
<h3 id="7完整的配置文件">7.完整的配置文件</h3>
<p>最后贴一个<strong>JUL</strong>可用的配置文件示例，其中<strong>RootLogger</strong>仅使用了<strong>ConsoleHandler</strong>输出日志：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">.level<span class="o">=</span>ALL
<span class="nv">handlers</span><span class="o">=</span>java.util.logging.ConsoleHandler

java.util.logging.ConsoleHandler.level<span class="o">=</span>ALL
java.util.logging.ConsoleHandler.encoding<span class="o">=</span>UTF-8

java.util.logging.FileHandler.level<span class="o">=</span>INFO
java.util.logging.FileHandler.pattern<span class="o">=</span>/sample%u.log
java.util.logging.FileHandler.limit<span class="o">=</span>1024*1024*10
java.util.logging.FileHandler.count<span class="o">=</span><span class="m">1</span>
java.util.logging.FileHandler.maxLocks<span class="o">=</span><span class="m">100</span>
java.util.logging.FileHandler.formatter<span class="o">=</span>java.util.logging.SimpleFormatter
java.util.logging.FileHandler.encoding<span class="o">=</span>UTF-8
java.util.logging.FileHandler.append<span class="o">=</span><span class="nb">true</span>
java.util.logging.SimpleFormatter.format<span class="o">=</span>%4<span class="nv">$s</span>: %5<span class="nv">$s</span> <span class="o">[</span>%1<span class="nv">$tc</span><span class="o">]</span>%n

cn.xyz.handlers<span class="o">=</span>java.util.logging.ConsoleHandler, java.util.logging.FileHandler
cn.xyz.level<span class="o">=</span>INFO
cn.xyz.useParentHandlers<span class="o">=</span><span class="nb">false</span>
</code></pre></div><p>关于其他的<strong>Handler</strong>不作演示了，因为实际遇到的情况很少，有需要的时候查阅相关官方资料即可。</p>
<span id="id-10">推荐将<strong>Handler</strong>的日志级别设置为<strong>ALL</strong>，然后通过各自的<strong>Logger</strong>对象，进行日志级别的控制。这样在配置文件中，只需要配置特定的<strong>Handler</strong>一次，即可让多个<strong>Logger</strong>对象进行使用。</span>
<p>默认情况下，如果不将<strong>useParentHandlers</strong>设置为<strong>false</strong>，那么<strong>Logger</strong>会同时使用<strong>RootLogger</strong>中的<strong>Handler</strong>。</p>
<hr>
<h2 id="日志实现log4j">日志实现Log4j</h2>
<p><strong>Log4j</strong>全称是<strong>Log for Java</strong>，它是<strong>Apache</strong>的一个开源项目，通过使用<strong>Log4j</strong>，我们可以控制日志信息输出的位置是控制台、文件还是<strong>GUI</strong>组件，输出位置甚至可以是套接口服务器、<strong>NT</strong>的事件记录器、<strong>UNIX Syslog</strong>守护进程等。</p>
<p>使用<strong>Log4j</strong>也可以控制每一条日志的输出格式，通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程。</p>
<h3 id="1入门案例">1.入门案例</h3>
<p>依旧使用<strong>Maven</strong>构建项目，此时需要引入<strong>Log4j</strong>的依赖：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>log4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>log4j<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.17<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p><strong>Log4j</strong>日志实现在默认情况下，要求提供配置文件。如果<strong>resource</strong>目录下不存在对应的<strong>log4j.properties</strong>配置文件，则控制台中会输出相应的警告信息。譬如以下代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
	<span class="c1">// 1.在没有log4j.properties的情况下，获取日志记录器对象Logger
</span><span class="c1"></span>    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Log4jTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">// 2.尝试输出日志记录
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Hey, log4j.&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>此时控制台不会输出对应的日志信息，取而代之仅会输出警告信息：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230164351490.png" title="/images/Log.images/image-20201230164351490.png" data-thumbnail="/images/Log.images/image-20201230164351490.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230164351490.png"
            data-srcset="/images/Log.images/image-20201230164351490.png, /images/Log.images/image-20201230164351490.png 1.5x, /images/Log.images/image-20201230164351490.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230164351490.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>接触过<strong>JUL</strong>的都知道，普通<strong>JUL</strong>的<strong>Logger</strong>如果没有进行额外的配置，默认是继承并使用<strong>RootLogger</strong>的配置，而不会出现任何警告信息。</p>
<p>同样地，<strong>Log4j</strong>中也存在<strong>RootLogger</strong>。但由于默认情况下<strong>Log4j</strong>中的<strong>RootLogger</strong>不具有任何的<strong>Appender</strong>（即<strong>Handler</strong>），因此直接使用<strong>Log4j</strong>，会出现警告信息。</p>
<p>如果代码仅为了测试某项功能，并不想编写复杂的<strong>log4j.properties</strong>，可以考虑使用<strong>Log4j</strong>中提供的默认配置。</p>
<p>需要加载<strong>Log4j</strong>中的默认<strong>Appender</strong>，只需要在获取<strong>Logger</strong>前使用<span id="id-11">BasicConfigurator.configure()</span>加载默认配置即可。</p>
<p>以下为<strong>BasicConfigurator</strong>中<span id="id-12">configure()</span>方法的源码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm">   Add a {@link ConsoleAppender} that uses {@link PatternLayout}
</span><span class="cm">   using the {@link PatternLayout#TTCC_CONVERSION_PATTERN} and
</span><span class="cm">   prints to &lt;code&gt;System.out&lt;/code&gt; to the root category.  */</span>
<span class="kd">static</span>
<span class="kd">public</span>
<span class="kt">void</span> <span class="nf">configure</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">Logger</span> <span class="n">root</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getRootLogger</span><span class="o">();</span>
  <span class="n">root</span><span class="o">.</span><span class="na">addAppender</span><span class="o">(</span><span class="k">new</span> <span class="n">ConsoleAppender</span><span class="o">(</span>
         <span class="k">new</span> <span class="n">PatternLayout</span><span class="o">(</span><span class="n">PatternLayout</span><span class="o">.</span><span class="na">TTCC_CONVERSION_PATTERN</span><span class="o">)));</span>
<span class="o">}</span>
</code></pre></div><p>古早时期的源码格式有点不太现代，但意义仍旧明确，如下：</p>
<span id="id-13">为<strong>RootLogger</strong>对象添加一个<strong>Appender</strong>，其中<strong>Appender</strong>的类型为控制器输出的<strong>ConsoleAppender</strong>，输出的格式遵循<strong>PatternLayout.TTCC_CONVERSION_PATTERN</strong>变量。</span>
<p>以下为<strong>PatternLayout.TTCC_CONVERSION_PATTERN</strong>源码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/** A conversion pattern equivalent to the TTCCCLayout.
</span><span class="cm">    Current value is &lt;b&gt;%r [%t] %p %c %x - %m%n&lt;/b&gt;. */</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">TTCC_CONVERSION_PATTERN</span>
                                           <span class="o">=</span> <span class="s">&#34;%r [%t] %p %c %x - %m%n&#34;</span><span class="o">;</span>
</code></pre></div><p>关于<strong>PatternLayout</strong>的相关格式化规则，后续会列举出来。</p>
<p>于是，使用以下代码在加载默认配置的前提下，尝试输出日志：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 1.初始化配置信息，使用默认的配置，如果不加载默认配置同时不具有log4j.properties配置文件，程序将发出警告
</span><span class="c1"></span>    <span class="n">BasicConfigurator</span><span class="o">.</span><span class="na">configure</span><span class="o">();</span>

    <span class="c1">// 2.获取日志记录器对象Logger
</span><span class="c1"></span>    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Log4jTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">// 3.日志记录输出
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Hey, log4j.&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>此时控制台输出为：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230170428578.png" title="/images/Log.images/image-20201230170428578.png" data-thumbnail="/images/Log.images/image-20201230170428578.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230170428578.png"
            data-srcset="/images/Log.images/image-20201230170428578.png, /images/Log.images/image-20201230170428578.png 1.5x, /images/Log.images/image-20201230170428578.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230170428578.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>日志输出成功。</p>
<h3 id="2日志级别">2.日志级别</h3>
<p><strong>Log4j</strong>中的日志级别与<strong>JUL</strong>的不同，<strong>Log4j</strong>一共提供了<strong>6</strong>种日志级别：</p>
<ol>
<li><strong>FATAL</strong>：严重错误，一般会造成系统崩溃并终止运行；</li>
<li><strong>ERROR</strong>：错误信息，不会影响系统运行；</li>
<li><strong>WARN</strong>：警告信息，可能会发生问题；</li>
<li><strong>INFO</strong>：运行信息，数据连接、网络连接、<strong>I/O</strong>操作等等；</li>
<li><strong>DEBUG</strong>：调试信息，一般在开发中使用，记录程序变量参数传递信息等等。<span id="id-14">默认级别；</span></li>
<li><strong>TRACE</strong>：追踪信息，记录程序所有的流程信息。</li>
</ol>
<p>参考以下示例代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 1.初始化配置信息，使用默认的配置，如果不加载默认配置同时不具有log4j.properties配置文件，程序将发出警告
</span><span class="c1"></span>    <span class="n">BasicConfigurator</span><span class="o">.</span><span class="na">configure</span><span class="o">();</span>

    <span class="c1">// 2.获取日志记录器对象Logger
</span><span class="c1"></span>    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Log4jTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">// 3.日志级别测试
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">fatal</span><span class="o">(</span><span class="s">&#34;[FATAL] 严重错误，一般会造成系统崩溃并终止运行。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;[ERROR] 错误信息，不会影响系统运行。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;[WARN] 警告信息，可能会发生问题。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO] 运行信息，数据连接、网络连接、I/O操作等等。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;[DEBUG] 调试信息，一般在开发中使用，记录程序变量参数传递信息等等。默认级别。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;[TRACE] 追踪信息，记录程序所有的流程信息。&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>运行输出，得到：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230170645463.png" title="/images/Log.images/image-20201230170645463.png" data-thumbnail="/images/Log.images/image-20201230170645463.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230170645463.png"
            data-srcset="/images/Log.images/image-20201230170645463.png, /images/Log.images/image-20201230170645463.png 1.5x, /images/Log.images/image-20201230170645463.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230170645463.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>输出的日志仍然由默认的日志级别所决定，其中默认级别为<strong>DEBUG</strong>。</p>
<p>为了测试默认日志级别，可以使用以下代码测试<strong>RootLogger</strong>：</p>
<ol>
<li>使用<span id="id-15">getRootLogger()</span>获取<strong>RootLogger</strong>对象；</li>
<li>使用<strong>RootLogger</strong>中的相关方法，获取日志对象的日志等级及其关联的<strong>Appender</strong>详情。</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDetails</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 1.初始化配置信息，使用默认的配置，如果不加载默认配置，将无法正常运行
</span><span class="c1"></span>    <span class="n">BasicConfigurator</span><span class="o">.</span><span class="na">configure</span><span class="o">();</span>

    <span class="c1">// 2.获取日志记录器对象RootLogger
</span><span class="c1"></span>    <span class="kd">final</span> <span class="n">Logger</span> <span class="n">rootLogger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getRootLogger</span><span class="o">();</span>

    <span class="c1">// 3.输出配置详情
</span><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Logger level: &#34;</span> <span class="o">+</span> <span class="n">rootLogger</span><span class="o">.</span><span class="na">getLevel</span><span class="o">());</span>
    <span class="kd">final</span> <span class="n">Enumeration</span> <span class="n">allAppenders</span> <span class="o">=</span> <span class="n">rootLogger</span><span class="o">.</span><span class="na">getAllAppenders</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">allAppenders</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">allAppenders</span><span class="o">.</span><span class="na">hasMoreElements</span><span class="o">())</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Appender</span> <span class="n">appender</span> <span class="o">=</span> <span class="o">(</span><span class="n">Appender</span><span class="o">)</span> <span class="n">allAppenders</span><span class="o">.</span><span class="na">nextElement</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Appender is: &#34;</span> <span class="o">+</span> <span class="n">appender</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>运行输出：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230171523635.png" title="/images/Log.images/image-20201230171523635.png" data-thumbnail="/images/Log.images/image-20201230171523635.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230171523635.png"
            data-srcset="/images/Log.images/image-20201230171523635.png, /images/Log.images/image-20201230171523635.png 1.5x, /images/Log.images/image-20201230171523635.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230171523635.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>注意，与<strong>JUL</strong>中的<strong>Handler</strong>不一样，对于<strong>Log4j</strong>中的<strong>Appender</strong>来说，它们不具有日志等级。</p>
<p><strong>Log4j</strong>中只有<strong>Logger</strong>对象具有日志等级。</p>
<h3 id="3相关组件">3.相关组件</h3>
<p><strong>Log4j</strong>主要由<strong>Loggers</strong>(日志记录器)、<strong>Appenders</strong>（输出端）和<strong>Layout</strong>（日志格式化器）组成，说明如下：</p>
<ol>
<li><strong>Loggers</strong>：控制日志的输出级别与日志是否输出；</li>
<li><strong>Appenders</strong>：指定日志的输出方式（输出到控制台、文件等）；</li>
<li><strong>Layout</strong>：控制日志信息的输出格式。</li>
</ol>
<span id="id-16">🌟3|a.Logger</span>
<p>日志记录器，负责收集处理日志记录，<strong>Logger</strong>的实例命名通常是类的全限定类名。<strong>Logger</strong>的名字大小写敏感，其命名有继承机制。</p>
<p>例如：<strong>name</strong>为<strong>org.apache.commons</strong>的<strong>logger</strong>会继承<strong>name</strong>为<strong>org.apache</strong>的<strong>logger</strong>。</p>
<p>自<strong>log4j 1.2</strong>版以来， <strong>Logger</strong>类已经取代了<strong>Category</strong>类。对于熟悉早期版本的<strong>log4j</strong>的人来说，<strong>Logger</strong>类可以被视为<strong>Category</strong>类的别名。</p>
<span id="id-17">🌟3|b.Appenders</span>
<p><strong>Appender</strong>用来指定日志输出到哪个地方，可以同时指定日志的输出目的地。</p>
<p><strong>Log4j</strong>常用的输出目的地有以下几种：</p>
<table>
<thead>
<tr>
<th style="text-align:center">输出端类型</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>ConsoleAppender</strong></td>
<td style="text-align:center">将日志输出到控制台</td>
</tr>
<tr>
<td style="text-align:center"><strong>FileAppender</strong></td>
<td style="text-align:center">将日志输出到文件中</td>
</tr>
<tr>
<td style="text-align:center"><strong>DailyRollingFileAppender</strong></td>
<td style="text-align:center">将日志输出到一个日志文件，周期为天，即每天输出</td>
</tr>
<tr>
<td style="text-align:center"><strong>RollingFileAppender</strong></td>
<td style="text-align:center">将日志信息输出到一个日志文件，并且指定文件的大小，当超过指定大小，会自动将文件重命名，同时产生一个新的文件</td>
</tr>
<tr>
<td style="text-align:center"><strong>JDBCAppender</strong></td>
<td style="text-align:center">将日志信息保存到数据库中</td>
</tr>
</tbody>
</table>
<span id="id-18">🌟3|c.Layouts</span>
<p>布局器<strong>Layouts</strong>用于控制日志输出内容的格式，我们可以使用各种自定义格式输出日志。</p>
<p><strong>Log4j</strong>常用的<strong>Layouts</strong>有以下几种:</p>
<table>
<thead>
<tr>
<th style="text-align:center">格式化器类型</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>HTMLLayout</strong></td>
<td style="text-align:center">格式化日志输出为HTML表格形式</td>
</tr>
<tr>
<td style="text-align:center"><strong>SimpleLayout</strong></td>
<td style="text-align:center">简单的日志输出格式，打印的日志格式为<strong>info-message</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>PatternLayout</strong></td>
<td style="text-align:center">最强大的格式化方式，可以根据自定义格式输出日志，如果没有指定转换格式，则使用默认的转换格式</td>
</tr>
</tbody>
</table>
<p><strong>PatternLayout</strong>中的格式化规则：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">* log4j采用类似C语言的printf函数的打印格式格式化日志信息，具体的占位符及其含义如下：
    %m 	输出代码中指定的日志信息
    %p 	输出优先级，及DEBUG、INFO等
    %n 	换行符（Windows平台的换行符为<span class="s2">&#34;\n&#34;</span>，Unix平台为<span class="s2">&#34;\n&#34;</span>）
    %r 	输出自应用启动到输出该 log 信息耗费的毫秒数
    %c 	输出打印语句所属的类的全名
    %t 	输出产生该日志的线程全名
    %d 	输出服务器当前时间，默认为ISO8601，也可以指定格式，如：%d<span class="o">{</span>yyyy年MM月dd日 HH:mm:ss<span class="o">}</span>
    %l 	输出日志时间发生的位置，包括类名、线程、及在代码中的行数。如：Test.main<span class="o">(</span>Test.java:10<span class="o">)</span>
    %F 	输出日志消息产生时所在的文件名称
    %L 	输出代码中的行号
    %% 	输出一个<span class="s2">&#34;%&#34;</span>字符

* 可以在%与字符之间加上修饰符来控制最小宽度、最大宽度和文本的对其方式。如：
    %5c 	输出category名称，最小宽度是5，category&lt;5，默认的情况下右对齐
    %-5c 	输出category名称，最小宽度是5，category&lt;5，<span class="s2">&#34;-&#34;</span>号指定左对齐,会有空格
    %.5c 	输出category名称，最大宽度是5，category&gt;5，就会将左边多出的字符截掉，&lt;5不会有空格
    %20.30c category名称&lt;20补空格，并且右对齐，&gt;30字符，就从左边交远销出的字符截掉
</code></pre></div><h3 id="4自定义配置-1">4.自定义配置</h3>
<p>使用<strong>Log4j</strong>一般不需要显式地加载配置文件，对于<strong>Maven</strong>项目来说，程序会自动扫描<strong>resources</strong>目录下的<strong>log4j.properties</strong>配置文件。</p>
<p>一个完整的<strong>log4j.properties</strong>配置文件如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 指定日志的输出级别与输出端</span>
log4j.rootLogger<span class="o">=</span>INFO, Console, UserDefinedName, logDB

<span class="c1"># 控制台输出配置</span>
log4j.appender.Console<span class="o">=</span>org.apache.log4j.ConsoleAppender
log4j.appender.Console.layout<span class="o">=</span>org.apache.log4j.PatternLayout
log4j.appender.Console.layout.ConversionPattern<span class="o">=</span>%d <span class="o">[</span>%t<span class="o">]</span> %-5p <span class="o">[</span>%c<span class="o">]</span> - %m%n

<span class="c1"># 文件输出配置</span>
log4j.appender.UserDefinedName<span class="o">=</span>org.apache.log4j.DailyRollingFileAppender
<span class="c1"># 指定日志的输出路径</span>
log4j.appender.UserDefinedName.File<span class="o">=</span>log4j.log
<span class="c1"># 是否以追加日志的形式添加</span>
log4j.appender.UserDefinedName.Append<span class="o">=</span><span class="nb">true</span>
<span class="c1"># 使用自定义日志格式化器</span>
log4j.appender.UserDefinedName.layout<span class="o">=</span>org.apache.log4j.PatternLayout
<span class="c1"># 指定日志的输出格式</span>
log4j.appender.UserDefinedName.layout.ConversionPattern<span class="o">=</span>%-d<span class="o">{</span>yyyy-MM-dd HH:mm:ss<span class="o">}</span> <span class="o">[</span>%t:%r<span class="o">]</span> - <span class="o">[</span>%p<span class="o">]</span> %m%n
<span class="c1"># 指定日志的文件编码</span>
log4j.appender.UserDefinedName.encoding<span class="o">=</span>UTF-8

<span class="c1"># MySQL输出配置</span>
log4j.appender.logDB<span class="o">=</span>org.apache.log4j.jdbc.JDBCAppender
log4j.appender.logDB.layout<span class="o">=</span>org.apache.log4j.PatternLayout
log4j.appender.logDB.Driver<span class="o">=</span>com.mysql.cj.jdbc.Driver
log4j.appender.logDB.URL<span class="o">=</span>jdbc:mysql://localhost:3306/test?serverTimezone<span class="o">=</span>GMT%2B8<span class="p">&amp;</span><span class="nv">useAffectedRows</span><span class="o">=</span><span class="nb">true</span>
log4j.appender.logDB.User<span class="o">=</span>root
log4j.appender.logDB.Password<span class="o">=</span>root
log4j.appender.logDB.Sql<span class="o">=</span>INSERT INTO log<span class="o">(</span>project_name, create_date, level, category, file_name, thread_name, line, all_category, message<span class="o">)</span> <span class="se">\
</span><span class="se"></span>  values<span class="o">(</span><span class="s1">&#39;log4j&#39;</span>, <span class="s1">&#39;%d{yyyy-MM-dd HH:mm:ss}&#39;</span>, <span class="s1">&#39;%p&#39;</span>, <span class="s1">&#39;%c&#39;</span>, <span class="s1">&#39;%F&#39;</span>, <span class="s1">&#39;%t&#39;</span>, <span class="s1">&#39;%L&#39;</span>, <span class="s1">&#39;%l&#39;</span>, <span class="s1">&#39;%m&#39;</span><span class="o">)</span>
</code></pre></div><p>此时，配置文件中规定了日志输出等级为<strong>INFO</strong>，同时<strong>RootLogger</strong>设置了三个不同的<strong>Appender</strong>，分别是：</p>
<ol>
<li><strong>ConsoleAppender</strong>：配置中被命名为<strong>Console</strong>；</li>
<li><strong>DailyRollingFileAppender</strong>：配置中被命名为<strong>UserDefinedName</strong>；</li>
<li><strong>JDBCAppender</strong>：配置中被命名为<strong>logDB</strong>。</li>
</ol>
<span id="id-19"><p><strong>RootLogger</strong>的默认日志输出级别配置在首行首位，随后紧跟的是相关联的<strong>Appender</strong>的名称，表示其默认支持输出的方式有哪些。</p>
<p>配置文件中可以配置多个类型可重复的<strong>Appender</strong>，但<strong>Appender</strong>之间的命名则不可重复。</p>
</span>
<p>配置中包含了<strong>sql</strong>输出日志的方式，对应的<strong>log</strong>表的创建代码为：</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">log</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="n">log_id</span><span class="o">`</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="n">project_name</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;项目名称&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="n">create_date</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;创建时间&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="k">level</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;优先级&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="n">category</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;所在类的全名&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="n">file_name</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;输出日志消息产生时所在的文件名称 &#39;</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="n">thread_name</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;日志事件的线程名&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="n">line</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;行号&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="n">all_category</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;日志事件的发生位置&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="o">`</span><span class="n">message</span><span class="o">`</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">4000</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;输出代码中指定的消息&#39;</span><span class="p">,</span><span class="w">
</span><span class="w">	</span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">`</span><span class="n">log_id</span><span class="o">`</span><span class="w"> </span><span class="p">)</span><span class="w"> 
</span><span class="w"></span><span class="p">);</span><span class="w">
</span></code></pre></div><p>如果希望让特定名称的<strong>Logger</strong>使用特定的配置，则需要在配置文件中定义以下格式的键名：<strong>log4j.logger.logger_name</strong>。</p>
<p>其中，<strong>logger_name</strong>就是指定<strong>Logger</strong>的名称，<strong>Log4j</strong>会自动为命名为<strong>logger_name</strong>的<strong>Logger</strong>应用配置。</p>
<p>但由于<strong>Logger</strong>仍然是隶属于<strong>RootLogger</strong>，因此日志输出默认情况下仍旧是累加的形式。</p>
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Example<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">例如，<strong>RootLogger</strong>使用了<strong>ConsoleAppender</strong>，同时特定名称的<strong>Logger</strong>也使用了<strong>ConsoleAppender</strong>，那么此时控制台将输出两次日志记录，一次为<strong>Logger</strong>继承自<strong>RootLogger</strong>的输出，另一次则为<strong>Logger</strong>自身的输出。</div>
        </div>
    </div>
<p>那么日志输出等级是否也是累加的形式呢？答案是否定的。日志等级取决于<strong>Logger</strong>和<strong>RootLogger</strong>，并以日志等级较高的一方为基准。</p>
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Example<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">例如，<strong>RootLogger</strong>和<strong>Logger</strong>同时使用了<strong>ConsoleAppender</strong>，但输出等级则分别为<strong>INFO</strong>和<strong>WARN</strong>，此时控制台输出的日志等级仅有高于等于<strong>WARN</strong>的记录，即使此时<strong>RootLogger</strong>的等级为<strong>INFO</strong>。</div>
        </div>
    </div>
<p>结合配置文件说明，假如有如下的配置文件：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 指定日志的输出级别与输出端</span>
log4j.rootLogger<span class="o">=</span>INFO, Console

<span class="c1"># 控制台输出配置</span>
log4j.appender.Console<span class="o">=</span>org.apache.log4j.ConsoleAppender
log4j.appender.Console.layout<span class="o">=</span>org.apache.log4j.PatternLayout
log4j.appender.Console.layout.ConversionPattern<span class="o">=</span>%d <span class="o">[</span>%t<span class="o">]</span> %-5p <span class="o">[</span>%c<span class="o">]</span> - %m%n

<span class="c1"># 让名为“cn.hanna”的logger使用名为Another的Appender</span>
<span class="c1"># 此时仍会使用rootLogger中的控制台输出，而Level则以两者间较高的为准</span>
log4j.logger.cn.hanna<span class="o">=</span>WARN, Console
</code></pre></div><p>配置表明，<strong>RootLogger</strong>和名为<strong>cn.hanna</strong>的<strong>Logger</strong>使用同一个<strong>ConsoleAppender</strong>，但日志等级不一致。</p>
<p>测试代码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAnother</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 1.获取日志记录器对象Logger
</span><span class="c1"></span>    <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.hanna&#34;</span><span class="o">);</span>

    <span class="c1">// 2.日志级别测试
</span><span class="c1"></span>    <span class="n">logger</span><span class="o">.</span><span class="na">fatal</span><span class="o">(</span><span class="s">&#34;[FATAL] 严重错误，一般会造成系统崩溃并终止运行。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;[ERROR] 错误信息，不会影响系统运行。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;[WARN] 警告信息，可能会发生问题。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO] 运行信息，数据连接、网络连接、I/O操作等等。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;[DEBUG] 调试信息，一般在开发中使用，记录程序变量参数传递信息等等。默认级别。&#34;</span><span class="o">);</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;[TRACE] 追踪信息，记录程序所有的流程信息。&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>运行输出：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230194119994.png" title="/images/Log.images/image-20201230194119994.png" data-thumbnail="/images/Log.images/image-20201230194119994.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230194119994.png"
            data-srcset="/images/Log.images/image-20201230194119994.png, /images/Log.images/image-20201230194119994.png 1.5x, /images/Log.images/image-20201230194119994.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230194119994.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>控制台对日志进行了两次输出，且输出的日志等级都是<strong>WARN</strong>以上的。</p>
<p>如何让普通的<strong>Logger</strong>不继承使用<strong>RootLogger</strong>中的<strong>Appender</strong>呢？或者说，如何让<strong>Logger</strong>仅进行一次日志输出呢？</p>
<p>如果一定需要使用<strong>ConsoleAppender</strong>，但不希望控制台输出两次记录，有两种方式：</p>
<ol>
<li>摒弃<strong>RootLogger</strong>的输出，即断开指定<strong>Logger</strong>与<strong>RootLogger</strong>的继承关系；</li>
<li>摒弃<strong>Logger</strong>的输出，即指定名称的<strong>Logger</strong>直接使用<strong>RootLogger</strong>关联的<strong>Appender</strong>，不再额外指定。</li>
</ol>
<p>如果选择断开指定<strong>Logger</strong>与<strong>RootLogger</strong>的继承关系，需修改配置文件如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 指定日志的输出级别与输出端</span>
log4j.rootLogger<span class="o">=</span>INFO, Console

<span class="c1"># 控制台输出配置</span>
log4j.appender.Console<span class="o">=</span>org.apache.log4j.ConsoleAppender
log4j.appender.Console.layout<span class="o">=</span>org.apache.log4j.PatternLayout
log4j.appender.Console.layout.ConversionPattern<span class="o">=</span>%d <span class="o">[</span>%t<span class="o">]</span> %-5p <span class="o">[</span>%c<span class="o">]</span> - %m%n

<span class="c1"># 名为“cn.hanna”的Logger不再继承使用RootLogger中的Appender</span>
log4j.additivity.cn.hanna<span class="o">=</span><span class="nb">false</span>
log4j.logger.cn.hanna<span class="o">=</span>WARN, Console
</code></pre></div><p>如果选择直接使用<strong>RootLogger</strong>关联的<strong>Appender</strong>，需修改配置文件如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 指定日志的输出级别与输出端</span>
log4j.rootLogger<span class="o">=</span>INFO, Console

<span class="c1"># 控制台输出配置</span>
log4j.appender.Console<span class="o">=</span>org.apache.log4j.ConsoleAppender
log4j.appender.Console.layout<span class="o">=</span>org.apache.log4j.PatternLayout
log4j.appender.Console.layout.ConversionPattern<span class="o">=</span>%d <span class="o">[</span>%t<span class="o">]</span> %-5p <span class="o">[</span>%c<span class="o">]</span> - %m%n

<span class="c1"># 对于名称“cn.hanna”的Logger来说，将直接使用RootLogger中关联的Appender，但日志等级由自身决定</span>
log4j.logger.cn.hanna<span class="o">=</span>WARN
</code></pre></div><p>使用以上两种方式，测试类运行结果均为：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201230195600215.png" title="/images/Log.images/image-20201230195600215.png" data-thumbnail="/images/Log.images/image-20201230195600215.png" data-sub-html="<h2>Console Output</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201230195600215.png"
            data-srcset="/images/Log.images/image-20201230195600215.png, /images/Log.images/image-20201230195600215.png 1.5x, /images/Log.images/image-20201230195600215.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201230195600215.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Console Output</strong></figcaption>
    </figure>
<p>实际应用中，应该灵活选择适合与代码的方式，去编写配置文件。</p>
<h3 id="5完整的配置文件示例">5.完整的配置文件示例</h3>
<p>同样，在此给出一个完整的<strong>log4j.properties</strong>配置文件示例：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">log4j.rootLogger<span class="o">=</span>INFO, Console

log4j.appender.Console<span class="o">=</span>org.apache.log4j.ConsoleAppender
log4j.appender.Console.layout<span class="o">=</span>org.apache.log4j.PatternLayout
log4j.appender.Console.layout.ConversionPattern<span class="o">=</span>%d <span class="o">[</span>%t<span class="o">]</span> %-5p <span class="o">[</span>%c<span class="o">]</span> - %m%n

log4j.appender.UserDefinedName<span class="o">=</span>org.apache.log4j.DailyRollingFileAppender
log4j.appender.UserDefinedName.File<span class="o">=</span>log4j.log
log4j.appender.UserDefinedName.Append<span class="o">=</span><span class="nb">true</span>
log4j.appender.UserDefinedName.layout<span class="o">=</span>org.apache.log4j.PatternLayout
log4j.appender.UserDefinedName.layout.ConversionPattern<span class="o">=</span>%-d<span class="o">{</span>yyyy-MM-dd HH:mm:ss<span class="o">}</span> <span class="o">[</span>%t:%r<span class="o">]</span> - <span class="o">[</span>%p<span class="o">]</span> %m%n
log4j.appender.UserDefinedName.encoding<span class="o">=</span>UTF-8

log4j.appender.logDB<span class="o">=</span>org.apache.log4j.jdbc.JDBCAppender
log4j.appender.logDB.layout<span class="o">=</span>org.apache.log4j.PatternLayout
log4j.appender.logDB.Driver<span class="o">=</span>com.mysql.cj.jdbc.Driver
log4j.appender.logDB.URL<span class="o">=</span>jdbc:mysql://localhost:3306/test?serverTimezone<span class="o">=</span>GMT%2B8<span class="p">&amp;</span><span class="nv">useAffectedRows</span><span class="o">=</span><span class="nb">true</span>
log4j.appender.logDB.User<span class="o">=</span>root
log4j.appender.logDB.Password<span class="o">=</span>root
log4j.appender.logDB.Sql<span class="o">=</span>INSERT INTO log<span class="o">(</span>project_name, create_date, level, category, file_name, thread_name, line, all_category, message<span class="o">)</span> <span class="se">\
</span><span class="se"></span>  values<span class="o">(</span><span class="s1">&#39;log4j&#39;</span>, <span class="s1">&#39;%d{yyyy-MM-dd HH:mm:ss}&#39;</span>, <span class="s1">&#39;%p&#39;</span>, <span class="s1">&#39;%c&#39;</span>, <span class="s1">&#39;%F&#39;</span>, <span class="s1">&#39;%t&#39;</span>, <span class="s1">&#39;%L&#39;</span>, <span class="s1">&#39;%l&#39;</span>, <span class="s1">&#39;%m&#39;</span><span class="o">)</span>

log4j.appender.Another<span class="o">=</span>org.apache.log4j.DailyRollingFileAppender
log4j.appender.Another.File<span class="o">=</span>hanna.log
log4j.appender.Another.Append<span class="o">=</span><span class="nb">true</span>
log4j.appender.Another.layout<span class="o">=</span>org.apache.log4j.PatternLayout
log4j.appender.Another.layout.ConversionPattern<span class="o">=</span>%-d<span class="o">{</span>yyyy-MM-dd HH:mm:ss<span class="o">}</span> <span class="o">[</span>%t:%r<span class="o">]</span> - <span class="o">[</span>%p<span class="o">]</span> %m%n
log4j.appender.Another.encoding<span class="o">=</span>UTF-8

log4j.logger.cn.xyz<span class="o">=</span>WARN, Another
log4j.additivity.cn.xyz<span class="o">=</span><span class="nb">false</span>
</code></pre></div><p>其中，<strong>log4j.appeder.appender_name</strong>中的<strong>appender_name</strong>为相应<strong>Appender</strong>的名称，该名称可以自行定义。</p>
<hr>
<h2 id="日志门面jcl">日志门面JCL</h2>
<p><strong>JCL</strong>全称<strong>Jakarta Commons Logging</strong>，是<strong>Apache</strong>提供的一个通用日志<strong>API</strong>，它为“所有的<strong>Java</strong>日志实现”提供了一个统一的接口。</p>
<p><strong>JCL</strong>自身提供了一个简单的日志实现<strong>SimpleLog</strong>，但功能非常弱，一般不会单独使用它。</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201202145208894.png" title="/images/Log.images/image-20201202145208894.png" data-thumbnail="/images/Log.images/image-20201202145208894.png" data-sub-html="<h2>JCL Framework</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201202145208894.png"
            data-srcset="/images/Log.images/image-20201202145208894.png, /images/Log.images/image-20201202145208894.png 1.5x, /images/Log.images/image-20201202145208894.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201202145208894.png" width="100%" />
    </a><figcaption class="image-caption"><strong>JCL Framework</strong></figcaption>
    </figure>
<p>在代码中使用<strong>JCL</strong>的代码获取<strong>Log</strong>对象，此时底层日志实现既可以使用<strong>JUL</strong>，也可以使用<strong>Log4j</strong>或<strong>SimpleLog</strong>。</p>
<h3 id="1日志级别">1.日志级别</h3>
<p><strong>JCL</strong>日志门面中所支持的日志级别，与<strong>Log4j</strong>中提供的默认日志级别一致。</p>
<p>即无论你使用的是哪种日志实现，其所提供的日志等级只有六种，回顾一下，分别为：</p>
<ol>
<li><strong>FATAL</strong>：严重错误，一般会造成系统崩溃并终止运行；</li>
<li><strong>ERROR</strong>：错误信息，不会影响系统运行；</li>
<li><strong>WARN</strong>：警告信息，可能会发生问题；</li>
<li><strong>INFO</strong>：运行信息，数据连接、网络连接、<strong>I/O</strong>操作等等；</li>
<li><strong>DEBUG</strong>：调试信息，一般在开发中使用，记录程序变量参数传递信息等等。<span id="id-20">默认级别；</span></li>
<li><strong>TRACE</strong>：追踪信息，记录程序所有的流程信息。</li>
</ol>
<h3 id="2入门案例-1">2.入门案例</h3>
<p>以<strong>Maven</strong>项目为示例，最基本的情况下，需要导入<strong>JCL</strong>依赖：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>commons-logging<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>commons-logging<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p><strong>JCL</strong>使用同一套代码来获取日志记录器<strong>Log</strong>对象，注意，日志记录器不再是<strong>Logger</strong>对象了。</p>
<p>获取<strong>Log</strong>对象的方法也很简单，只需要使用<strong>JCL</strong>中提供了<strong>LogFactory</strong>类中的静态方法<span id="id-21">getLog()</span>即可。</p>
<p>那么，<strong>JCL</strong>如何确定底层所使用的日志门面是什么呢？</p>
<p><strong>JCL</strong>底层有一个用于存储其所支持的日志实现的全限定类名的数组，一旦按顺序成功创建了某个日志的实现，将不再继续往后创建其他的日志，默认使用当下创建成功的日志实现。</p>
<p><strong>JCL</strong>日志门面支持的日志实现数组：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">classesToDiscover</span> <span class="o">=</span> 
    <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;org.apache.commons.logging.impl.Log4JLogger&#34;</span><span class="o">,</span> 
                 <span class="s">&#34;org.apache.commons.logging.impl.Jdk14Logger&#34;</span><span class="o">,</span> 
                 <span class="s">&#34;org.apache.commons.logging.impl.Jdk13LumberjackLogger&#34;</span><span class="o">,</span> 
                 <span class="s">&#34;org.apache.commons.logging.impl.SimpleLog&#34;</span><span class="o">};</span>
</code></pre></div><p><strong>JCL</strong>获取具体日志实现的代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">classesToDiscover</span><span class="o">.</span><span class="na">length</span> <span class="o">&amp;&amp;</span> <span class="n">result</span> <span class="o">==</span> <span class="kc">null</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">result</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">createLogFromClass</span><span class="o">(</span><span class="n">classesToDiscover</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">logCategory</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><p>不难看出，<strong>JCL</strong>将会按照<strong>String[] classesToDiscover</strong>的顺序去创建<strong>Logger</strong>对象，一旦创建成功，则会跳出<strong>for</strong>循环。</p>
<p>其中日志门面优先级为：<strong>Log4JLogger</strong> &gt; <strong>Jdk14Logger</strong> &gt; <strong>Jdk13LumberjackLogger</strong> &gt; <strong>SimpleLog</strong>。</p>
<p>注意，此时日志门面的使用规则，并不是根据是否存在配置文件决定，而是根据当前环境是否有指定日志实现的依赖而决定。</p>
<div class="details admonition example open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ol fa-fw"></i>Example<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>例如，环境中拥有<strong>Log4j</strong>的依赖，即便没有<strong>Log4j</strong>配置文件的存在，<strong>JCL</strong>仍然默认使用<strong>Log4j</strong>作为日志实现。显然，此时会出现警告，<strong>JCL</strong>也并不会因为不存在<strong>Log4j</strong>配置文件，而选择使用<strong>JUL</strong>日志实现。</p>
<p>如果希望使用的是<strong>JUL</strong>日志实现，只需要将<strong>Log4j</strong>的依赖从<strong>pom.xml</strong>中剔除并更新即可。</p>
</div>
        </div>
    </div>
<p>以下为简单的<strong>JCL</strong>测试代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">cn.dylanphang.jcl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.commons.logging.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.LogFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author dylan
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JclTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 1.创建日志记录器对象Log
</span><span class="c1"></span>        <span class="n">Log</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LogFactory</span><span class="o">.</span><span class="na">getLog</span><span class="o">(</span><span class="n">JclTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 2.日志级别测试
</span><span class="c1"></span>        <span class="n">log</span><span class="o">.</span><span class="na">fatal</span><span class="o">(</span><span class="s">&#34;[FATAL] 严重错误，一般会造成系统崩溃并终止运行。&#34;</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;[ERROR] 错误信息，不会影响系统运行。&#34;</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;[WARN] 警告信息，可能会发生问题。&#34;</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;[INFO] 运行信息，数据连接、网络连接、I/O操作等等。&#34;</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;[DEBUG] 调试信息，一般在开发中使用，记录程序变量参数传递信息等等。默认级别。&#34;</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;[TRACE] 追踪信息，记录程序所有的流程信息。&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p><strong>JCL</strong>在选用不同的日志实现时，其差别主要在于不同的日志实现间具有不同的输出效率，及其所支持的输出位置的不同等等。</p>
<p>至于日志格式，无论是<strong>Log4j</strong>还是<strong>JUL</strong>，它们都是支持根据配置文件来更改日志格式的，几乎没有差别。</p>
<hr>
<h2 id="日志门面slf4j">日志门面Slf4j</h2>
<p><strong>slf4j</strong>的全称是<strong>Simple Logging Facade for Java</strong>，简单日志门面主要是为了给<strong>Java</strong>日志访问提供一套标准、规范的<strong>API</strong>接口，其主要的意义在于提供接口，具体的实现可以交由其他日志实现，例如<strong>log4j</strong>或<strong>logback</strong>等。</p>
<p><strong>slf4j</strong>也有提供功能较为简单的日志实现，但一般不用。对于<strong>Java</strong>项目而言，日志会选择<strong>sl4j-api</strong>作为日志门面，再配上具体的日志实现<strong>log4j</strong>、<strong>logback</strong>等一起使用，日志门面和日志实现直接需要使用桥接器建立联系。</p>
<p>为什么在具有<strong>JCL</strong>日志门面的前提下，仍然要使用<strong>slf4j</strong>作为日志门面？</p>
<p><strong>slf4j</strong>日志门面具有以下优势：</p>
<ol>
<li>使用<strong>slf4j</strong>框架，可以在部署时迁移到所需的日志记录框架；</li>
<li><strong>slf4j</strong>提供了对所有流行的日志实现的绑定，例如<strong>log4j</strong>、<strong>JUL</strong>、<strong>logback</strong>、<strong>log4j2</strong>等；</li>
<li>无论使用哪种绑定，<strong>slf4j</strong>都支持参数化日志记录消息。由于<strong>slf4j</strong>将应用程序和日志记录框架分离，因此可以轻松编写独立于日志记录框架的应用程序。而无需担心用于编写应用程序的日志记录框架；</li>
<li><strong>slf4j</strong>提供了一个简单的<strong>Java</strong>工具，称为迁移器。使用此工具，可以迁移现有使用日志实现<strong>JCL</strong>、<strong>Log4j</strong>或<strong>JUL</strong>的项目到<strong>slf4j</strong>。</li>
</ol>
<h3 id="1日志级别-1">1.日志级别</h3>
<p><strong>slf4j</strong>日志门面，提供了<strong>5</strong>个不同的基本日志级别，分别是：</p>
<ol>
<li><strong>ERROR</strong>：错误信息，不会影响系统运行；</li>
<li><strong>WARN</strong>：警告信息，可能会发生问题；</li>
<li><strong>INFO</strong>：运行信息，数据连接、网络连接、<strong>I/O</strong>操作等等；</li>
<li><strong>DEBUG</strong>：调试信息，一般在开发中使用，记录程序变量参数传递信息等等。<span id="id-22">默认级别；</span></li>
<li><strong>TRACE</strong>：追踪信息，记录程序所有的流程信息。</li>
</ol>
<h3 id="2入门案例-2">2.入门案例</h3>
<p>案例使用Maven创建，并使用<strong>slf4j</strong>中的简单日志实现进行示例，需要引入<strong>slf4j</strong>的依赖，和其简单日志实现<strong>slf4j-simple</strong>的依赖：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-simple<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p><strong>slf4j</strong>作为日志门面时，获取日志记录对象为<strong>Logger</strong>，获取方式是通过<strong>slf4j</strong>中的<strong>LoggerFactory</strong>类提供的静态方法<span id="id-23">getLogger()</span>。</p>
<p>示例代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author dylan
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Slf4jTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 1.创建日志记录器对象Logger
</span><span class="c1"></span>        <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Slf4jTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 2.输出各等级日志，slf4j默认的日志等级是DEBUG
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;ERROR&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;WARN&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;INFO&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;DEBUG&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;TRACE&#34;</span><span class="o">);</span>

        <span class="c1">// 3.使用占位符输出日志信息
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;用户信息：{}, {}&#34;</span><span class="o">,</span> <span class="s">&#34;dylan&#34;</span><span class="o">,</span> <span class="n">12</span><span class="o">);</span>

        <span class="c1">// 4.将异常信息写入日志
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;all&#34;</span><span class="o">)</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span> <span class="o">/</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;出现异常：&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>输出结果省略。</p>
<h3 id="3绑定日志实现">3.绑定日志实现</h3>
<p>绑定日志实现主要是针对新项目而言的，当你需要选择新项目系统构成时，为了便于日后日志实现可能作出的改变，应当选用支持更多日志实现的<strong>slf4j</strong>作为日志门面，使用它提供的<strong>API</strong>来获取日志记录对象。</p>
<p>即使你可能在日后需要从<strong>JUL</strong>转为<strong>log4j</strong>，如果一开始选择使用<strong>slf4j</strong>日志门面，那么未来需要从<strong>JUL</strong>转为<strong>log4j</strong>日志实现时，也无须改动代码，只需要更改依赖、添加<strong>log4j.properties</strong>配置文件即可。</p>
<p>通过日志绑定，<strong>slf4j</strong>可以支持各种日志实现。绑定日志实现的步骤如下：</p>
<ol>
<li>添加<strong>slf4j-api</strong>的依赖；</li>
<li>使用<strong>slf4j</strong>的<strong>API</strong>在项目中进行统一的日志记录；</li>
<li>绑定具体的日志实现框架：
<ol>
<li>绑定已经实现了<strong>slf4j</strong>的日志实现，可直接添加对应依赖，如<strong>logback</strong>、<strong>slf4j-simple</strong>；</li>
<li>绑定没有实现<strong>slf4j</strong>的日志实现，先添加日志适配器，再添加日志实现的依赖，如<strong>log4j</strong>、<strong>JUL</strong>。</li>
</ol>
</li>
</ol>
<p>注意，<strong>slf4j</strong>有且仅有一个日志实现框架的绑定（如果出现多个，则默认使用第一个日志实现依赖）。</p>
<figure><a class="lightgallery" href="/images/Log.images/concrete-bindings.png" title="/images/Log.images/concrete-bindings.png" data-thumbnail="/images/Log.images/concrete-bindings.png" data-sub-html="<h2>Concrete Bindings</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/concrete-bindings.png"
            data-srcset="/images/Log.images/concrete-bindings.png, /images/Log.images/concrete-bindings.png 1.5x, /images/Log.images/concrete-bindings.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/concrete-bindings.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Concrete Bindings</strong></figcaption>
    </figure>
<p>事实上，所谓的绑定等同于引入依赖。对应依赖引入关系如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- slf4j-api日志门面，需要使用此API获取日志记录对象 --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- logback，自动引入了logback-core --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;exclusions&gt;</span>
        <span class="nt">&lt;exclusion&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/exclusion&gt;</span>
    <span class="nt">&lt;/exclusions&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- slf4j-simple --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-simple<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- log4j --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>log4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>log4j<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.17<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!-- JUL --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-jdk14<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.25<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!--
</span><span class="c">    JCL，
</span><span class="c">    如果不提供log4j的依赖，则默认使用JUL日志实现，那实际上直接使用slf4j-jdk14即可；
</span><span class="c">    如果提供了log4j的依赖，那实际上可以被替换slf4j-log4j12.
</span><span class="c">--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-jcl<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><h3 id="4桥接旧的日志实现">4.桥接旧的日志实现</h3>
<p>桥接<strong>Bridging</strong>则主要针对旧项目而言，当旧项目没有选择使用<strong>slf4j</strong>作为日志门面时，那意味着项目使用的要么是<strong>JCL</strong>日志门面，要么则是直接使用了<strong>log4j</strong>或<strong>JUL</strong>日志实现。</p>
<p>项目一旦需要使用更为高效的日志实现<strong>logback</strong>或<strong>log4j2</strong>时，在不改动旧代码的情况下，可以使用<strong>slf4j</strong>提供的<strong>Bridging</strong>桥接功能，将<strong>JCL</strong>或<strong>log4j</strong>、<strong>JUL</strong>日志门面或实现桥接到<strong>slf4j-api</strong>中。</p>
<p>一旦桥接到<strong>slf4j-api</strong>后，就可以使用绑定功能，将日志无缝转换为新的日志实现。此时需要提供新日志实现的配置文件，同时需要保留旧的日志实现配置文件。</p>
<p>所以，为了防止从旧的日志门面或实现桥接为<strong>slf4j-api</strong>后，又通过绑定功能输出为原本旧的日志门面或实现的情况发生，以下依赖不能同时引入，否则将会造成<strong>Out of Memory</strong>错误：</p>
<ol>
<li><strong>jcl-over-slf4j</strong> | <strong>slf4j-jcl</strong>；</li>
<li><strong>log4j-over-slf4j</strong> | <strong>slf4j-log4j12</strong>；</li>
<li><strong>jul-to-slf4j</strong> | <strong>slf4j-jdk14</strong>；</li>
<li><strong>log4j-to-slf4j</strong> | <strong>log4j-slf4j-impl</strong>。</li>
</ol>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>Tip<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">桥接功能仅针对<strong>JCL</strong>、<strong>log4j</strong>、<strong>JUL</strong>、<strong>log4j2</strong>等日志门面或日志实现。因为后续的日志实现<strong>logback</strong>、<strong>slf4j-simple</strong>都默认使用<strong>slf4j</strong>作为日志门面，不存在需要桥接的情况。</div>
        </div>
    </div>
<p>桥接解决的是项目中日志遗留问题，当系统中存在之前的<strong>API</strong>，可以通过桥接转换到<strong>slf4j</strong>的实现：</p>
<ol>
<li>先取出之前老的日志实现依赖，即移除老的日志实现依赖；</li>
<li>添加<strong>slf4j</strong>提供的桥接组件，桥接组件不可以桥接到老的日志实现；</li>
<li>为项目添加<strong>slf4j</strong>的具体实现。</li>
</ol>
<figure><a class="lightgallery" href="/images/Log.images/legacy.png" title="/images/Log.images/legacy.png" data-thumbnail="/images/Log.images/legacy.png" data-sub-html="<h2>Legacy</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/legacy.png"
            data-srcset="/images/Log.images/legacy.png, /images/Log.images/legacy.png 1.5x, /images/Log.images/legacy.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/legacy.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Legacy</strong></figcaption>
    </figure>
<p>注意，如果项目使用的是<strong>log4j2</strong>的日志实现，此时需要使用的桥接器是<strong>log4j-to-slf4j.jar</strong>，该桥接器是用于<strong>log4j2</strong>桥接<strong>slf4j</strong>日志门面的。<strong>log4j-over-slf4j.jar</strong>则是用于<strong>log4j</strong>桥接<strong>slf4j</strong>日志门面。</p>
<hr>
<h2 id="日志实现logback">日志实现Logback</h2>
<p><strong>logback</strong>是由<strong>log4j</strong>创始人设计的另一个开源日志组件，性能要比<strong>log4j</strong>好。</p>
<p><strong>logback</strong>主要分为三个模块：</p>
<ol>
<li><strong>logback-core</strong>：其它两个模块的基础模块；</li>
<li><strong>logback-classic</strong>：它是<strong>log4j</strong>的一个改良版本，同时它完整实现了<strong>slf4j</strong>的<strong>API</strong>；</li>
<li><strong>logback-access</strong>：访问模块与<strong>Servlet</strong>容器继承提供通过<strong>Http</strong>来访问日志的功能。</li>
</ol>
<h3 id="1日志级别-2">1.日志级别</h3>
<p><strong>logback</strong>默认使用<strong>slf4j</strong>的<strong>API</strong>，因此日志级别与<strong>slf4j</strong>日志门面提供的日志级别一致。</p>
<p>另外，有<strong>2</strong>种特殊的日志级别，用于开关日志：</p>
<ol>
<li><strong>OFF</strong>：用于关闭日志记录；</li>
<li><strong>ALL</strong>：用于启用日志记录。</li>
</ol>
<h3 id="2入门案例-3">2.入门案例</h3>
<p>同样采用<strong>Maven</strong>项目，导入依赖：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p>使用<strong>logback</strong>需要导入<strong>logback-core</strong>和<strong>logback-classic</strong>，由于Maven会自动导入依赖，只需要引入<strong>logback-classic</strong>，即可以自动关联<strong>logback-core</strong>依赖了。</p>
<p><strong>logback</strong>在设计之初就已经是支持<strong>slf4j</strong>日志门面了，可以选择性排除由<strong>logback-classic</strong>引入的<strong>slf4j-api</strong>，使用一个更新的<strong>slf4j</strong>版本。</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;exclusions&gt;</span>
        <span class="nt">&lt;exclusion&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/exclusion&gt;</span>
    <span class="nt">&lt;/exclusions&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p>关于<strong>logback-access</strong>模块将在章节末进行介绍。</p>
<p>由于是使用<strong>slf4j</strong>日志门面，因此获取<strong>Logger</strong>的代码与前一小节一致：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author dylan
</span><span class="cm"> * @date 2020/12/03
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogbackTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 1.创建日志记录器对象Logger
</span><span class="c1"></span>        <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">LogbackTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 2.输出各等级日志，slf4j默认日志等级是DEBUG
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;ERROR&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;WARN&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;INFO&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;DEBUG&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;TRACE&#34;</span><span class="o">);</span>

        <span class="c1">// 3.使用占位符输出日志信息
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;用户信息：{}, {}&#34;</span><span class="o">,</span> <span class="s">&#34;dylan&#34;</span><span class="o">,</span> <span class="n">12</span><span class="o">);</span>

        <span class="c1">// 4.将异常信息写入日志
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;all&#34;</span><span class="o">)</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span> <span class="o">/</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;出现异常：&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="3logback组件">3.logback组件</h3>
<p><strong>Logger</strong>：日志的记录器，把它关联到应用的对应的<strong>context</strong>上后，主要用于存放日志对象，也
可以定义日志类型、级别。</p>
<p><strong>Appender</strong>：用于指定日志输出的目的地，目的地可以是控制台、文件、数据库等等。</p>
<p><strong>Layout</strong>：负责把事件转换成字符串，格式化的日志信息的输出。在<strong>logback</strong>中<strong>Layout</strong>对象被封装在<strong>Encoder</strong>中。</p>
<h3 id="4配置文件">4.配置文件</h3>
<p><strong>logback</strong>会根据顺序读取以下配置文件：</p>
<ol>
<li><strong>logback-test.xml</strong>；</li>
<li><strong>logback.groovy</strong>；</li>
<li><strong>logback.xml</strong>。</li>
</ol>
<p>如果指定名称的配置文件均不存在，则会采用默认配置。</p>
<p>日志输出格式：</p>
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>%level</strong></td>
<td style="text-align:center">日志等级</td>
</tr>
<tr>
<td style="text-align:center"><strong>%d{yyyy-MM-dd HH:mm:ss.SSS}</strong></td>
<td style="text-align:center">日期和时间</td>
</tr>
<tr>
<td style="text-align:center"><strong>%c</strong></td>
<td style="text-align:center">全限定类名</td>
</tr>
<tr>
<td style="text-align:center"><strong>%M</strong></td>
<td style="text-align:center">方法名</td>
</tr>
<tr>
<td style="text-align:center"><strong>%L</strong></td>
<td style="text-align:center">行号</td>
</tr>
<tr>
<td style="text-align:center"><strong>%thread</strong></td>
<td style="text-align:center">线程名称</td>
</tr>
<tr>
<td style="text-align:center"><strong>%m</strong> 或 <span id="id-24">%msg</span></td>
<td style="text-align:center">日志信息</td>
</tr>
<tr>
<td style="text-align:center"><strong>%n</strong></td>
<td style="text-align:center">换行</td>
</tr>
</tbody>
</table>
<p>以下配置文件包括以下<strong>Appender</strong>：</p>
<ol>
<li><strong>ConsoleAppender</strong>：日志将在控制台输出；</li>
<li><strong>FileAppender</strong>：日志将在文件输出；</li>
<li><strong>RollingFileAppender</strong>：日志可以根据日志文件大小进行拆分与压缩。</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

    <span class="c">&lt;!-- 通用的日志格式，使用占位符可以引用此格式 --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;pattern&#34;</span> <span class="na">value=</span><span class="s">&#34;%d{yyyy-MM-dd HH:mm:ss.SSS} %c [%thread] %-5level %msg%n&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;htmlPattern&#34;</span> <span class="na">value=</span><span class="s">&#34;%level%d{yyyy-MM-dd HH:mm:ss}%c%M%L%thread%m&#34;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!--
</span><span class="c">        Level：TRACE, DEBUG, INFO, WARN, ERROR, ALL, OFF
</span><span class="c">        Appender: 设置日志信息的去向,常用的有以下几个
</span><span class="c">            1. ch.qos.logback.core.ConsoleAppender (控制台)
</span><span class="c">            2. ch.qos.logback.core.FileAppender (文件)
</span><span class="c">            3. ch.qos.logback.core.rolling.RollingFileAppender (文件大小到达指定大小的时候将产生一个新文件)
</span><span class="c">
</span><span class="c">    --&gt;</span>

    <span class="c">&lt;!-- 控制台输出对象ConsoleAppender配置 --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&#34;console&#34;</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- 输出流对象，默认System.out，更改为System.err后输出将变为红色 --&gt;</span>
        <span class="nt">&lt;target&gt;</span>System.err<span class="nt">&lt;/target&gt;</span>
        <span class="c">&lt;!-- 日志格式 --&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.encoder.PatternLayoutEncoder&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${pattern}<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
        <span class="c">&lt;!-- LevelFilter设置，有且仅会输出指定等级的日志，例如设置为INFO时，只会输出INFO的日志 --&gt;</span>
        <span class="nt">&lt;filter</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.filter.LevelFilter&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;level&gt;</span>INFO<span class="nt">&lt;/level&gt;</span>
            <span class="nt">&lt;onMatch&gt;</span>ACCEPT<span class="nt">&lt;/onMatch&gt;</span>
            <span class="nt">&lt;onMismatch&gt;</span>DENY<span class="nt">&lt;/onMismatch&gt;</span>
        <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!-- 文件输出对象FileAppender配置，使用PatternLayoutEncoder只需要提供普通日志格式，即可生成文本日志 --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&#34;file&#34;</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.FileAppender&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- 日志格式 --&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.encoder.PatternLayoutEncoder&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${pattern}<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
        <span class="c">&lt;!-- 日志输出路径--&gt;</span>
        <span class="nt">&lt;file&gt;</span>/logback.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!-- 文件输出对象FileAppender配置，使用LayoutWrappingEncoder并配置日志的HTML格式，日志文件将以HTML格式生成 --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&#34;htmlFile&#34;</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.FileAppender&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- 日志格式 --&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.encoder.LayoutWrappingEncoder&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;layout</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.html.HTMLLayout&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;pattern&gt;</span>${htmlPattern}<span class="nt">&lt;/pattern&gt;</span>
            <span class="nt">&lt;/layout&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
        <span class="c">&lt;!-- 日志输出 --&gt;</span>
        <span class="nt">&lt;file&gt;</span>/logback.html<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!-- 日志文件拆分与归档对象RollingFileAppender配置 --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&#34;rollFile&#34;</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- 日志格式 --&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.encoder.PatternLayoutEncoder&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${pattern}<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
        <span class="c">&lt;!-- 日志输出路径 --&gt;</span>
        <span class="nt">&lt;file&gt;</span>/roll_logback.log<span class="nt">&lt;/file&gt;</span>
        <span class="c">&lt;!-- 指定日志文件拆分与归档规则 --&gt;</span>
        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&#34;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- 当单个日志文件roll_logback.log大小到达1MB后，文件将进行压缩，roll_logback.log日志将重新开始记录 --&gt;</span>
            <span class="nt">&lt;maxFileSize&gt;</span>1MB<span class="nt">&lt;/maxFileSize&gt;</span>
            <span class="c">&lt;!-- 通过指定压缩文件名称，来确定压缩文件的命名方式，该名称也作为日志文件的名称，%i占位符默认从0开始以+1的方式自增 --&gt;</span>
            <span class="nt">&lt;fileNamePattern&gt;</span>/rolling.%d{yyyy-MM-dd}.log%i.gz<span class="nt">&lt;/fileNamePattern&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!--
</span><span class="c">        如果需要设置某一个包或者具体的某一个类的日志打印级别或指定它所使用的appender，可以使用&lt;logger&gt;标签。
</span><span class="c">        标签&lt;logger&gt;仅包含三个属性，其中name为必选属性，而level和additivity为可选属性。
</span><span class="c">            1. name：用来指定受此logger约束的某一个包或者某一个类；
</span><span class="c">            2. level：用来设置日志级别，大小写无关，如果未设置此属性，那么当前logger将会继承父日志的日志级别；
</span><span class="c">            3. additivity：默认值true。是否使用父日志的appender，为false时仅logger中的appender生效。
</span><span class="c">        标签&lt;logger&gt;可以包含零个或多个&lt;appender-ref&gt;标签，该标签用于指定该logger的appender。
</span><span class="c">    --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&#34;cn.hanna&#34;</span> <span class="na">level=</span><span class="s">&#34;warn&#34;</span> <span class="na">additivity=</span><span class="s">&#34;true&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="c">&lt;!--
</span><span class="c">        标签&lt;root&gt;表示rootLogger对象，和&lt;logger&gt;标签一样，但只有一个可选属性level，用于设置日志级别，默认级别为debug。
</span><span class="c">        标签&lt;root&gt;可以包含零个或多个&lt;appender-ref&gt;标签，该标签用于指定该logger的appender。
</span><span class="c">
</span><span class="c">        注意：logger与rootLogger的日志等级是以较高的为准，但存在特例。当rootLogger的等级为OFF，而logger等级为INFO时，
</span><span class="c">        logger的日志输出情况与rootLogger的日志等级为ALL时一致，即无法通过关闭rootLogger的日志去间接关闭logger的日志。
</span><span class="c">    --&gt;</span>
    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&#34;ALL&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;file&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;htmlFile&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;rollFile&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div><p>注意，普通<strong>Logger</strong>与<strong>RootLogger</strong>的日志等级是以较高的为准，但存在特例。</p>
<p>当<strong>RootLogger</strong>的等级为<strong>OFF</strong>，而普通<strong>Logger</strong>等级为<strong>INFO</strong>时，<strong>Logger</strong>的日志输出情况与<strong>RootLogger</strong>的日志等级为<strong>ALL</strong>时一致。即无法通过关闭<strong>RootLogger</strong>的日志去间接关闭<strong>Logger</strong>的日志。</p>
<p><strong>Filter</strong>标签中的<strong>LevelFilter</strong>，如果进行了配置，则仅支持指定等级的日志输出。</p>
<p>测试代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author dylan
</span><span class="cm"> * @date 2020/12/03
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogbackTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 1.创建日志记录器对象Logger
</span><span class="c1"></span>        <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">LogbackTest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 2.输出各等级日志，slf4j默认日志等级是DEBUG
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;ERROR&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;WARN&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;INFO&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;DEBUG&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;TRACE&#34;</span><span class="o">);</span>

        <span class="c1">// 3.使用占位符输出日志信息
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;用户信息：{}, {}&#34;</span><span class="o">,</span> <span class="s">&#34;dylan&#34;</span><span class="o">,</span> <span class="n">12</span><span class="o">);</span>

        <span class="c1">// 4.将异常信息写入日志
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;all&#34;</span><span class="o">)</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span> <span class="o">/</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;出现异常：&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testLogger</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 1.创建日志记录器对象Logger
</span><span class="c1"></span>        <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.hanna&#34;</span><span class="o">);</span>

        <span class="c1">// 2.cn.hanna的默认输出等级为WARN，该logger的appender为ConsoleAppender
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;ERROR&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;WARN&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;INFO&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;DEBUG&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;TRACE&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="5异步日志">5.异步日志</h3>
<p>此前所有的日志输出都是同步的，使用<strong>logback</strong>提供的异步日志，可以增加日志的输出效率，需要使用<strong>AsyncAppender</strong>将其他的<strong>Appender</strong>设置为异步形式输出日志。</p>
<p>可以将某一个<strong>appender</strong>设置为异步日志，参考以下配置文件：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;pattern&#34;</span> <span class="na">value=</span><span class="s">&#34;%d{yyyy-MM-dd HH:mm:ss.SSS} %c [%thread] %-5level %msg%n&#34;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&#34;console&#34;</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;target&gt;</span>System.err<span class="nt">&lt;/target&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.encoder.PatternLayoutEncoder&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${pattern}<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&#34;file&#34;</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.FileAppender&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.encoder.PatternLayoutEncoder&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${pattern}<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
        <span class="nt">&lt;file&gt;</span>/logback.log<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!-- 异步日志 --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&#34;async&#34;</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.AsyncAppender&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;file&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&#34;ALL&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
        <span class="c">&lt;!-- 激活异步功能 --&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;async&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div><h3 id="6log-access模块">6.log-access模块</h3>
<p><strong>logback-access</strong>模块与<strong>Servlet</strong>容器（如<strong>Tomcat</strong>和<strong>Jetty</strong>）集成，以提供<strong>HTTP</strong>访问日志功能。</p>
<p>我们可以使用<strong>logback-access</strong>模块来替换<strong>tomcat</strong>的访问日志，作为了解即可。不再赘述。</p>
<hr>
<h2 id="日志实现log4j2">日志实现Log4j2</h2>
<p><strong>Apache Log4j 2</strong>是对<strong>Log4j</strong>的升级版，参考了<strong>logback</strong>的一些优秀的设计，并且修复了一些问题，带来了一些重大的提升：</p>
<ol>
<li>异常处理，在<strong>logback</strong>中，<strong>Appender</strong>中的异常不会被应用感知到，但是在<strong>log4j2</strong>中，提供了一些异常处理机制；</li>
<li>性能提升， <strong>log4j2</strong>相较于<strong>log4j</strong>和<strong>logback</strong>都具有很明显的性能提升；</li>
<li>自动重载配置，参考了<strong>logback</strong>的设计，当然会提供自动刷新参数配置，最实用的就是我们在生产上可以动态的修改日志的级别而不需要重启应用；</li>
<li>无垃圾机制，<strong>log4j2</strong>在大部分情况下，都可以使用其设计的一套无垃圾机制，避免频繁的日志收集导致的<strong>jvm gc</strong>。</li>
</ol>
<h3 id="1日志级别-3">1.日志级别</h3>
<p><strong>Log4j2</strong>提供了<strong>5</strong>个日志级别，分别是：</p>
<ol>
<li><strong>ERROR</strong>：错误信息，不会影响系统运行；</li>
<li><strong>WARN</strong>：警告信息，可能会发生问题；</li>
<li><strong>INFO</strong>：运行信息，数据连接、网络连接、<strong>I/O</strong>操作等等；</li>
<li><strong>DEBUG</strong>：调试信息，一般在开发中使用，记录程序变量参数传递信息等等。<span id="id-25">默认级别；</span></li>
<li><strong>TRACE</strong>：追踪信息，记录程序所有的流程信息。</li>
</ol>
<h3 id="2入门案例-4">2.入门案例</h3>
<p>使用<strong>Maven</strong>项目作为示例，单纯使用<strong>log4j2</strong>，仅需添加依赖：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>log4j-core<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.13.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p>此时，获取日志记录对象<strong>Logger</strong>的方式，使用的是<strong>log4j2</strong>提供的<strong>API</strong>，调用<strong>LogManager</strong>中的静态方法<span id="id-26">getLogger()</span>即可。</p>
<p>测试代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.logging.log4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.logging.log4j.LogManager</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author dylan
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Log4j2Test</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 1.创建日志记录器对象Logger
</span><span class="c1"></span>        <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LogManager</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Log4j2Test</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 2.输出各等级日志，log4j2默认日志等级是ERROR
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;ERROR&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;WARN&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;INFO&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;DEBUG&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;TRACE&#34;</span><span class="o">);</span>

        <span class="c1">// 3.使用占位符输出日志信息
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;用户信息：{}, {}&#34;</span><span class="o">,</span> <span class="s">&#34;dylan&#34;</span><span class="o">,</span> <span class="n">12</span><span class="o">);</span>

        <span class="c1">// 4.将异常信息写入日志
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;all&#34;</span><span class="o">)</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span> <span class="o">/</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;出现异常：&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>但实际上，通常会使用日志门面<strong>slf4j</strong>配合<strong>log4j2</strong>的形式，添加<strong>slf4j</strong>适配器可以实现连接，如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.30<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="c">&lt;!-- slf4j绑定log4j2 --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>log4j-slf4j-impl<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.13.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>log4j-core<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.13.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p>现在可以使用<strong>slf4j</strong>的<strong>API</strong>操作<strong>log4j2</strong>了，示例代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author dylan
</span><span class="cm"> * @date 2020/12/03
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Log4j2Test</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 1.创建日志记录器对象Logger
</span><span class="c1"></span>        <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Log4j2Test</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 2.输出各等级日志，log4j2默认日志等级是ERROR
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;ERROR&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;WARN&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;INFO&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;DEBUG&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;TRACE&#34;</span><span class="o">);</span>

        <span class="c1">// 3.使用占位符输出日志信息
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;用户信息：{}, {}&#34;</span><span class="o">,</span> <span class="s">&#34;dylan&#34;</span><span class="o">,</span> <span class="n">12</span><span class="o">);</span>

        <span class="c1">// 4.将异常信息写入日志
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;all&#34;</span><span class="o">)</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span> <span class="o">/</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;出现异常：&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="3配置文件">3.配置文件</h3>
<p>由于<strong>log4j2</strong>是参考<strong>logback</strong>设置的，因此其中的组件基本相同，配置文件也大同小异。唯一需要注意的是<strong>ThresholdFilter</strong>，该过滤器是会保留<strong>level</strong>等级及其以上等级的日志信息。</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="c">&lt;!--
</span><span class="c">    status：日志实现本身的日志输出等级；
</span><span class="c">    monitorInterval：自动重新载入配置文件的时间间隔。
</span><span class="c">--&gt;</span>
<span class="nt">&lt;Configuration</span> <span class="na">status=</span><span class="s">&#34;OFF&#34;</span> <span class="na">monitorInterval=</span><span class="s">&#34;5&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;pattern&#34;</span><span class="nt">&gt;</span>[%d{yyyy-MM-dd HH:mm:ss.SSS}] [%-5level] %l%c - %m%n<span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;filePattern&#34;</span><span class="nt">&gt;</span>d:/logs/$${date:yyyy-MM-dd}/rolling-%d{yyyy-MM-dd HH-mm-ss}-%i.log<span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;logFile&#34;</span><span class="nt">&gt;</span>d:/logs<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;Appenders&gt;</span>
        <span class="c">&lt;!-- 控制台输出日志 --&gt;</span>
        <span class="nt">&lt;Console</span> <span class="na">name=</span><span class="s">&#34;console&#34;</span> <span class="na">target=</span><span class="s">&#34;SYSTEM_OUT&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">&#34;%d{HH:mm:ss.SSS} [%t] [%-5level] %c:%L - %m%n&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Console&gt;</span>

        <span class="c">&lt;!-- 文件输出日志 --&gt;</span>
        <span class="c">&lt;!-- 关于ThresholdFilter中的等级level，指的是接受该等级或以上等级日志的输出，和logback中的levelFilter不太一样 --&gt;</span>
        <span class="nt">&lt;File</span> <span class="na">name=</span><span class="s">&#34;file&#34;</span> <span class="na">fileName=</span><span class="s">&#34;${logFile}/log4j2.log&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ThresholdFilter</span> <span class="na">level=</span><span class="s">&#34;DEBUG&#34;</span> <span class="na">onMatch=</span><span class="s">&#34;ACCEPT&#34;</span> <span class="na">onMismatch=</span><span class="s">&#34;DENY&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">&#34;${pattern}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/File&gt;</span>

        <span class="c">&lt;!-- 文件输出日志，但使用随机读写流，性能提高 --&gt;</span>
        <span class="nt">&lt;RandomAccessFile</span> <span class="na">name=</span><span class="s">&#34;accessFile&#34;</span> <span class="na">fileName=</span><span class="s">&#34;${logFile}/log4j2-acc.log&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">&#34;${pattern}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/RandomAccessFile&gt;</span>

        <span class="c">&lt;!--
</span><span class="c">            文件输出，但会根据一定的规则将文件进行拆分与归档，需要压缩则将filePattern的后缀改为压缩文件后缀。
</span><span class="c">
</span><span class="c">            关于filePattern：/$${date:yyyy-MM-dd}/rolling-%d{yyyy-MM-dd HH-mm-ss}-%i.log
</span><span class="c">            解析：是以天为单位创建文件夹，以秒为单位创建.log文件
</span><span class="c">        --&gt;</span>
        <span class="nt">&lt;RollingFile</span> <span class="na">name=</span><span class="s">&#34;rollingFile&#34;</span> <span class="na">fileName=</span><span class="s">&#34;${logFile}/log4j2-rolling.log&#34;</span> <span class="na">filePattern=</span><span class="s">&#34;${filePattern}&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">&#34;${pattern}&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;Policies&gt;</span>
                <span class="c">&lt;!-- 在系统启动时，触发拆分规则，产生新的日志文件，可以省略此标签 --&gt;</span>
                <span class="nt">&lt;OnStartupTriggeringPolicy/&gt;</span>
                <span class="c">&lt;!-- 按照文件大小拆分，设置拆分大小，可以不被包裹在&lt;Policies&gt;标签中使用 --&gt;</span>
                <span class="nt">&lt;SizeBasedTriggeringPolicy</span> <span class="na">size=</span><span class="s">&#34;10MB&#34;</span><span class="nt">/&gt;</span>
                <span class="c">&lt;!-- 按照时间节点拆分，已经根据filePattern配置，可以省略此标签 --&gt;</span>
                <span class="nt">&lt;TimeBasedTriggeringPolicy/&gt;</span>
            <span class="nt">&lt;/Policies&gt;</span>
            <span class="c">&lt;!-- 指定在同一个目录下文件的最大个数，如果超过则会根据时间进行覆盖，防止文件日志过多 --&gt;</span>
            <span class="nt">&lt;DefaultRolloverStrategy</span> <span class="na">max=</span><span class="s">&#34;30&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/RollingFile&gt;</span>
    <span class="nt">&lt;/Appenders&gt;</span>

    <span class="nt">&lt;Loggers&gt;</span>
        <span class="c">&lt;!-- 配置rootLogger的日志级别和appender类型--&gt;</span>
        <span class="nt">&lt;Root</span> <span class="na">level=</span><span class="s">&#34;TRACE&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;file&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;accessFile&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;rollingFile&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Root&gt;</span>
        <span class="c">&lt;!-- 配置自定义logger中的日志级别和appender，属性、子标签的配置与logback一致--&gt;</span>
        <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&#34;cn.hanna&#34;</span> <span class="na">level=</span><span class="s">&#34;WARN&#34;</span> <span class="na">additivity=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/logger&gt;</span>
    <span class="nt">&lt;/Loggers&gt;</span>
<span class="nt">&lt;/Configuration&gt;</span>
</code></pre></div><p>测试代码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @author dylan
</span><span class="cm"> * @date 2020/12/03
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Log4j2Test</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testQuick</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 1.创建日志记录器对象Logger
</span><span class="c1"></span>        <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Log4j2Test</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 2.输出各等级日志，log4j2默认日志等级是ERROR
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;ERROR&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;WARN&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;INFO&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;DEBUG&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;TRACE&#34;</span><span class="o">);</span>

        <span class="c1">// 3.使用占位符输出日志信息
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;用户信息：{}, {}&#34;</span><span class="o">,</span> <span class="s">&#34;dylan&#34;</span><span class="o">,</span> <span class="n">12</span><span class="o">);</span>

        <span class="c1">// 4.将异常信息写入日志
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;all&#34;</span><span class="o">)</span>
            <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span> <span class="o">/</span> <span class="n">0</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;出现异常：&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testLogger</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 1.创建日志记录器对象Logger
</span><span class="c1"></span>        <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.hanna&#34;</span><span class="o">);</span>

        <span class="c1">// 2.cn.hanna的默认输出等级为WARN，该logger的appender为Console
</span><span class="c1"></span>        <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;ERROR&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;WARN&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;INFO&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;DEBUG&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;TRACE&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="4异步日志">4.异步日志</h3>
<p><strong>log4j2</strong>在异步日志上有较大的提升，主要得益于采用了<strong>AsyncLogger</strong>的方式，大大提高了异步日志的性能。</p>
<figure><a class="lightgallery" href="/images/Log.images/async-throughput-comparison.png" title="/images/Log.images/async-throughput-comparison.png" data-thumbnail="/images/Log.images/async-throughput-comparison.png" data-sub-html="<h2>Async Throughput Comparison</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/async-throughput-comparison.png"
            data-srcset="/images/Log.images/async-throughput-comparison.png, /images/Log.images/async-throughput-comparison.png 1.5x, /images/Log.images/async-throughput-comparison.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/async-throughput-comparison.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Async Throughput Comparison</strong></figcaption>
    </figure>
<p><strong>log4j2</strong>支持两种种异步日志的实现，有：</p>
<ol>
<li><strong>AsyncAppender</strong>：和<strong>logback</strong>中的异步日志形式一致，采用<strong>appender</strong>异步的方式实现；</li>
<li><strong>AsyncLogger</strong>：在<strong>logger</strong>层面上实现的异步日志。</li>
</ol>
<p><strong>AsyncLogger</strong>可以进一步细分为两种：</p>
<ul>
<li><strong>AsyncLogger</strong>全局异步：使所有的<strong>logger</strong>都采用异步的方式进行输出，通过<strong>log4j2.component.properties</strong>配置，不需要更改原配置文件的设置；</li>
<li><strong>AsyncLogger</strong>局部异步：使部分<strong>logger</strong>采用异步的方式进行输出，通过修改<strong>log4j2.properties</strong>设置实现。</li>
</ul>
<p><strong>AsyncAppender</strong>和<strong>AsyncLogger</strong>同时使用时，性能与单独使用<strong>AsyncAppender</strong>时一致，因此更推荐使用<strong>AsyncLogger</strong>。</p>
<span id="id-27">🌟4|a.AsyncAppender</span>
<p>通过在标签<span id="id-28">&lt;Appenders&gt;</span>中添加子标签<span id="id-29">&lt;Async&gt;</span>，可以将以配置好的<strong>appender</strong>设置为异步的<strong>appender</strong>：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;Configuration</span> <span class="na">status=</span><span class="s">&#34;OFF&#34;</span> <span class="na">monitorInterval=</span><span class="s">&#34;5&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;pattern&#34;</span><span class="nt">&gt;</span>[%d{yyyy-MM-dd HH:mm:ss.SSS}] [%-5level] %l%c{36} - %m%n<span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;logFile&#34;</span><span class="nt">&gt;</span>d:/logs<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;Appenders&gt;</span>
        <span class="nt">&lt;Console</span> <span class="na">name=</span><span class="s">&#34;console&#34;</span> <span class="na">target=</span><span class="s">&#34;SYSTEM_OUT&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">&#34;%d{HH:mm:ss.SSS} [%t] [%-5level] %c{36}:%L - %m%n&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Console&gt;</span>

        <span class="nt">&lt;File</span> <span class="na">name=</span><span class="s">&#34;file&#34;</span> <span class="na">fileName=</span><span class="s">&#34;${logFile}/log4j2.log&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ThresholdFilter</span> <span class="na">level=</span><span class="s">&#34;DEBUG&#34;</span> <span class="na">onMatch=</span><span class="s">&#34;ACCEPT&#34;</span> <span class="na">onMismatch=</span><span class="s">&#34;DENY&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">&#34;${pattern}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/File&gt;</span>

        <span class="c">&lt;!-- 异步日志 --&gt;</span>
        <span class="nt">&lt;Async</span> <span class="na">name=</span><span class="s">&#34;async&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;file&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Async&gt;</span>
    <span class="nt">&lt;/Appenders&gt;</span>

    <span class="nt">&lt;Loggers&gt;</span>
        <span class="nt">&lt;Root</span> <span class="na">level=</span><span class="s">&#34;TRACE&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
            <span class="c">&lt;!-- 激活异步功能 --&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;async&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Root&gt;</span>

        <span class="nt">&lt;Logger</span> <span class="na">name=</span><span class="s">&#34;cn.hanna&#34;</span> <span class="na">level=</span><span class="s">&#34;WARN&#34;</span> <span class="na">additivity=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Logger&gt;</span>
    <span class="nt">&lt;/Loggers&gt;</span>
<span class="nt">&lt;/Configuration&gt;</span>
</code></pre></div><span id="id-30">🌟4|b.AsyncLogger 全局异步</span>
<p>采用异步<strong>logger</strong>的形式，需要额外添加一个依赖：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.lmax<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>disruptor<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.3.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p>配置全局异步，不需要改动原本的配置文件，额外添加一个<strong>log4j2.component.properties</strong>的配置文件即可：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># log4j2全局异步配置，当使用局部异步时，此文件不能共存</span>
<span class="nv">Log4jContextSelector</span><span class="o">=</span>org.apache.logging.log4j.core.async.AsyncLoggerContextSelector
</code></pre></div><span id="id-31">🌟4|c.AsyncLogger 局部异步</span>
<p>多数情况下会使用局部异步的方式，此时全局异步必须关闭，否则局部异步无法生效。</p>
<p>采用异步<strong>logger</strong>的形式，需要额外添加一个依赖：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.lmax<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>disruptor<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.3.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p>通过在标签**<!-- raw HTML omitted -->**中添加子标签**<!-- raw HTML omitted -->**，通过其属性可以将指定名称的**logger**配置成异步**logger**，如下：</p>
<ul>
<li><strong>includeLocation</strong>：该属性表示是否输出行号，输出行号将降低异步日志器的性能，推荐关闭；</li>
<li>即使此时<strong>PatternLayout</strong>包括行号**%L**，也不会输出行号信息。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;Configuration</span> <span class="na">status=</span><span class="s">&#34;OFF&#34;</span> <span class="na">monitorInterval=</span><span class="s">&#34;5&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;pattern&#34;</span><span class="nt">&gt;</span>[%d{yyyy-MM-dd HH:mm:ss.SSS}] [%-5level] %l%c{36} - %m%n<span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;logFile&#34;</span><span class="nt">&gt;</span>d:/logs<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;Appenders&gt;</span>
        <span class="nt">&lt;Console</span> <span class="na">name=</span><span class="s">&#34;console&#34;</span> <span class="na">target=</span><span class="s">&#34;SYSTEM_OUT&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">&#34;%d{HH:mm:ss.SSS} [%t] [%-5level] %c{36}:%L - %m%n&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Console&gt;</span>

        <span class="nt">&lt;File</span> <span class="na">name=</span><span class="s">&#34;file&#34;</span> <span class="na">fileName=</span><span class="s">&#34;${logFile}/log4j2.log&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;ThresholdFilter</span> <span class="na">level=</span><span class="s">&#34;DEBUG&#34;</span> <span class="na">onMatch=</span><span class="s">&#34;ACCEPT&#34;</span> <span class="na">onMismatch=</span><span class="s">&#34;DENY&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">&#34;${pattern}&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/File&gt;</span>
    <span class="nt">&lt;/Appenders&gt;</span>

    <span class="nt">&lt;Loggers&gt;</span>
        <span class="nt">&lt;Root</span> <span class="na">level=</span><span class="s">&#34;TRACE&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;file&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Root&gt;</span>

        <span class="c">&lt;!-- 异步logger，其中includeLocation属性为是否包含行号，是否输出行号将显著影响异步logger的性能，推荐关闭 --&gt;</span>
        <span class="nt">&lt;AsyncLogger</span> <span class="na">name=</span><span class="s">&#34;cn.hanna&#34;</span> <span class="na">level=</span><span class="s">&#34;WARN&#34;</span> <span class="na">includeLocation=</span><span class="s">&#34;false&#34;</span> <span class="na">additivity=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/AsyncLogger&gt;</span>
    <span class="nt">&lt;/Loggers&gt;</span>
<span class="nt">&lt;/Configuration&gt;</span>
</code></pre></div><h3 id="5无垃圾记录模式">5.无垃圾记录模式</h3>
<p>无垃圾模式，官网中有如下介绍：</p>
<ul>
<li>From version 2.6, Log4j runs in &ldquo;garbage free&rdquo; mode by default where objects and buffers are reused and no temporary objects are allocated as much as possible.</li>
<li>There is also a &ldquo;low garbage&rdquo; mode which is not completely garbage free but does not use ThreadLocal fields. This is the default mode when Log4j detects it is running in a web application.</li>
<li>Finally, it is possible to switch off all garbage-free logic and run in &ldquo;classic mode&rdquo; instead.</li>
</ul>
<p>大致意思是，<strong>log4j2</strong>自版本<strong>2.6</strong>之后，将默认开启<strong>garbage free</strong>无垃圾记录模式。在进行异步日志时，该模式有助于性能提升。</p>
<figure><a class="lightgallery" href="/images/Log.images/ResponseTimeAsyncLogging4Threads@16kEach.png" title="/images/Log.images/ResponseTimeAsyncLogging4Threads@16kEach.png" data-thumbnail="/images/Log.images/ResponseTimeAsyncLogging4Threads@16kEach.png" data-sub-html="<h2>Response Time Async Logging 4 Threads</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/ResponseTimeAsyncLogging4Threads@16kEach.png"
            data-srcset="/images/Log.images/ResponseTimeAsyncLogging4Threads@16kEach.png, /images/Log.images/ResponseTimeAsyncLogging4Threads@16kEach.png 1.5x, /images/Log.images/ResponseTimeAsyncLogging4Threads@16kEach.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/ResponseTimeAsyncLogging4Threads@16kEach.png" width="100%" />
    </a><figcaption class="image-caption"><strong>Response Time Async Logging 4 Threads</strong></figcaption>
    </figure>
<p>对于无垃圾记录模式了解即可，更多关于性能和无垃圾记录模式，可以访问以下链接：</p>
<ul>
<li><a href="https://logging.apache.org/log4j/2.x/performance.html" target="_blank" rel="noopener noreffer"><strong>Log4j - performance</strong></a></li>
<li><a href="https://logging.apache.org/log4j/2.x/manual/garbagefree.html" target="_blank" rel="noopener noreffer"><strong>Log4j - garbagefree</strong></a></li>
</ul>
<hr>
<h2 id="springboot中的日志实现">SpringBoot中的日志实现</h2>
<p><strong>SpringBoot</strong>中使用了模块<strong>spring-boot-starter-logging</strong>用于管理日志，其结构如下：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201203211515503.png" title="/images/Log.images/image-20201203211515503.png" data-thumbnail="/images/Log.images/image-20201203211515503.png" data-sub-html="<h2>SpringBoot Logging Framework</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201203211515503.png"
            data-srcset="/images/Log.images/image-20201203211515503.png, /images/Log.images/image-20201203211515503.png 1.5x, /images/Log.images/image-20201203211515503.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201203211515503.png" width="100%" />
    </a><figcaption class="image-caption"><strong>SpringBoot Logging Framework</strong></figcaption>
    </figure>
<p><strong>SpringBoot</strong>默认的日志门面是<strong>slf4j</strong>，其默认使用的日志实现是<strong>logback</strong>。简而言之，使用<strong>slf4j</strong>获取的日志记录对象，默认使用的是<strong>logback</strong>日志实现。</p>
<p><strong>SpringBoot</strong>也支持使用<strong>JUL</strong>、<strong>Log4j2</strong>获取日志记录对象<strong>Logger</strong>，但由于<strong>slf4j</strong>桥接器的存在，它们最终使用<strong>logback</strong>的配置进行输出。</p>
<h3 id="1入门案例-1">1.入门案例</h3>
<p><strong>SpringBoot</strong>项目的默认依赖就会导入<strong>spring-boot-starter-logging</strong>模块：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p>项目依赖：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201203213139157.png" title="/images/Log.images/image-20201203213139157.png" data-thumbnail="/images/Log.images/image-20201203213139157.png" data-sub-html="<h2>Dependency</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201203213139157.png"
            data-srcset="/images/Log.images/image-20201203213139157.png, /images/Log.images/image-20201203213139157.png 1.5x, /images/Log.images/image-20201203213139157.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201203213139157.png" width="70%" />
    </a><figcaption class="image-caption"><strong>Dependency</strong></figcaption>
    </figure>
<p>测试代码：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">cn.dylanphang.springbootlog</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">SpringbootLogApplicationTests</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">testLog4j2</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">logging</span><span class="o">.</span><span class="na">log4j</span><span class="o">.</span><span class="na">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">logging</span><span class="o">.</span><span class="na">log4j</span><span class="o">.</span><span class="na">LogManager</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SpringbootLogApplicationTests</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Using log4j2.&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">testJul</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">logging</span><span class="o">.</span><span class="na">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">logging</span><span class="o">.</span><span class="na">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.dylanphang.springbootlog.SpringbootLogApplicationTests&#34;</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Using JUL.&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">testLogback</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">org</span><span class="o">.</span><span class="na">slf4j</span><span class="o">.</span><span class="na">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">slf4j</span><span class="o">.</span><span class="na">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SpringbootLogApplicationTests</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Using Logback.&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p><strong>testLog4j2</strong>()输出结果：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201203213356777.png" title="/images/Log.images/image-20201203213356777.png" data-thumbnail="/images/Log.images/image-20201203213356777.png" data-sub-html="<h2>log4j2</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201203213356777.png"
            data-srcset="/images/Log.images/image-20201203213356777.png, /images/Log.images/image-20201203213356777.png 1.5x, /images/Log.images/image-20201203213356777.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201203213356777.png" width="100%" />
    </a><figcaption class="image-caption"><strong>log4j2</strong></figcaption>
    </figure>
<p><strong>testJul</strong>()输出结果：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201203213416653.png" title="/images/Log.images/image-20201203213416653.png" data-thumbnail="/images/Log.images/image-20201203213416653.png" data-sub-html="<h2>JUL</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201203213416653.png"
            data-srcset="/images/Log.images/image-20201203213416653.png, /images/Log.images/image-20201203213416653.png 1.5x, /images/Log.images/image-20201203213416653.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201203213416653.png" width="100%" />
    </a><figcaption class="image-caption"><strong>JUL</strong></figcaption>
    </figure>
<p><strong>testLogback</strong>()输出结果：</p>
<figure><a class="lightgallery" href="/images/Log.images/image-20201203213432965.png" title="/images/Log.images/image-20201203213432965.png" data-thumbnail="/images/Log.images/image-20201203213432965.png" data-sub-html="<h2>logback</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="/images/Log.images/image-20201203213432965.png"
            data-srcset="/images/Log.images/image-20201203213432965.png, /images/Log.images/image-20201203213432965.png 1.5x, /images/Log.images/image-20201203213432965.png 2x"
            data-sizes="auto"
            alt="/images/Log.images/image-20201203213432965.png" width="100%" />
    </a><figcaption class="image-caption"><strong>logback</strong></figcaption>
    </figure>
<p>无论使用哪种日志门面，最终都会以同一种日志形式输出。</p>
<h3 id="2配置文件">2.配置文件</h3>
<p><strong>SpringBoot</strong>可以解析<strong>logback</strong>的配置文件，以下按解析优先度排序：</p>
<table>
<thead>
<tr>
<th style="text-align:center">配置文件</th>
<th style="text-align:center">可接受的日志实现</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>logback.xml</strong></td>
<td style="text-align:center"><strong>logback</strong>、<strong>log4j2</strong>、<strong>JUL</strong></td>
</tr>
<tr>
<td style="text-align:center"><strong>logback-spring.xml</strong></td>
<td style="text-align:center"><strong>logback</strong>、<strong>log4j2</strong>、<strong>JUL</strong></td>
</tr>
</tbody>
</table>
<p><strong>logback.xml</strong>和<strong>logback-spring.xml</strong>的区别，在于后者是支持被<strong>SpringBoot</strong>所解析的，你可以在<strong>application.properties</strong>中，配置处于特定生产环境所需要加载的特定规则，而规则分类则添加在<strong>logback-spring.xml</strong>中。</p>
<p>例如，以下<strong>logback-spring.xml</strong>配置文件：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;patternDev&#34;</span> <span class="na">value=</span><span class="s">&#34;%d{yyyy-MM-dd HH:mm:ss.SSS} %c [%thread] %-5level - [dev] %msg%n&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;patternPro&#34;</span> <span class="na">value=</span><span class="s">&#34;%d{yyyy-MM-dd HH:mm:ss.SSS} %c [%thread] %-5level - [pro] %msg%n&#34;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&#34;console&#34;</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;target&gt;</span>System.err<span class="nt">&lt;/target&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.encoder.PatternLayoutEncoder&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;springProfile</span> <span class="na">name=</span><span class="s">&#34;dev&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;pattern&gt;</span>${patternDev}<span class="nt">&lt;/pattern&gt;</span>
            <span class="nt">&lt;/springProfile&gt;</span>
            <span class="nt">&lt;springProfile</span> <span class="na">name=</span><span class="s">&#34;pro&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;pattern&gt;</span>${patternPro}<span class="nt">&lt;/pattern&gt;</span>
            <span class="nt">&lt;/springProfile&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&#34;INFO&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div><p>此时只需要在<strong>application.properties</strong>中配置<strong>spring.profiles.active</strong>属性，即可根据<strong>dev</strong>或<strong>pro</strong>的值加载不同配置。</p>
<p>使用<strong>pro</strong>环境下的日志格式，则配置如下：</p>
<pre><code class="language-properties" data-lang="properties">spring.profiles.active=pro
</code></pre><p>使用<strong>dev</strong>环境下的日志格式，则配置如下：</p>
<pre><code class="language-properties" data-lang="properties">spring.profiles.active=dev
</code></pre><h3 id="3默认配置文件">3.默认配置文件</h3>
<p><strong>SpringBoot</strong>除了可以使用相关日志实现的配置文件外，也可以在其默认的<strong>application.properties</strong>中自定义日志配置。</p>
<p>当选择在<strong>application.properties</strong>中配置日志时，<strong>SpringBoot</strong>默认输出的日志文件名为<strong>Spring.log</strong>。</p>
<p>假如，<strong>application.properties</strong>中有以下配置：</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># 配置控制台输出日志的格式</span>
logging.pattern.console<span class="o">=</span>%d<span class="o">{</span>yyyy-MM-dd HH:mm:ss.SSS<span class="o">}</span> %c <span class="o">[</span>%thread<span class="o">]</span> %-5level %msg%n

<span class="c1"># 配置文件输出日志的格式及路径等</span>
logging.file.path<span class="o">=</span>d:/logs
logging.pattern.file<span class="o">=</span>%d<span class="o">{</span>yyyy-MM-dd HH:mm:ss.SSS<span class="o">}</span> %c <span class="o">[</span>%thread<span class="o">]</span> %-5level %msg%n
logging.charset.file<span class="o">=</span>UTF-8

<span class="c1"># 为某些特定名字的logger设置日志等级，但输出的appender仍然是以上两个</span>
logging.level.cn.hanna<span class="o">=</span>trace
</code></pre></div><p>测试代码如下：</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">cn.dylanphang.springbootlog</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">SpringbootLogApplicationTests</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">testLogback</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SpringbootLogApplicationTests</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Using Logback.&#34;</span><span class="o">);</span>

        <span class="n">Logger</span> <span class="n">logger2</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&#34;cn.hanna&#34;</span><span class="o">);</span>
        <span class="n">logger2</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;Cn hanna.&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="4替换logback">4.替换logback</h3>
<p>如果希望<strong>SpringBoot</strong>的底层不使用<strong>logback</strong>，则需要改变<strong>pom.xml</strong>依赖：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="c">&lt;!-- 排除原本的logging模块 --&gt;</span>
    <span class="nt">&lt;exclusions&gt;</span>
        <span class="nt">&lt;exclusion&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-logging<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/exclusion&gt;</span>
    <span class="nt">&lt;/exclusions&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="c">&lt;!-- 添加logj2日志模块 --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-log4j2<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div><p>之后配置文件默认将识别<strong>log4j2.xml</strong>或<strong>log4j2-spring.xml</strong>，以下配置可用于测试：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="c">&lt;!--
</span><span class="c">    status：日志实现本身的日志输出等级；
</span><span class="c">    monitorInterval：自动重新载入配置文件的时间间隔。
</span><span class="c">--&gt;</span>
<span class="nt">&lt;Configuration</span> <span class="na">status=</span><span class="s">&#34;OFF&#34;</span> <span class="na">monitorInterval=</span><span class="s">&#34;5&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;pattern&#34;</span><span class="nt">&gt;</span>[%d{yyyy-MM-dd HH:mm:ss.SSS}] [%-5level] %l%c - %m%n<span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;Appenders&gt;</span>
        <span class="c">&lt;!-- 控制台输出日志 --&gt;</span>
        <span class="nt">&lt;Console</span> <span class="na">name=</span><span class="s">&#34;console&#34;</span> <span class="na">target=</span><span class="s">&#34;SYSTEM_OUT&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;PatternLayout</span> <span class="na">pattern=</span><span class="s">&#34;%d{HH:mm:ss.SSS} [%t] [%-5level] %c:%L - %m%n&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Console&gt;</span>

    <span class="nt">&lt;/Appenders&gt;</span>

    <span class="nt">&lt;Loggers&gt;</span>
        <span class="c">&lt;!-- 配置rootLogger的日志级别和appender类型--&gt;</span>
        <span class="nt">&lt;Root</span> <span class="na">level=</span><span class="s">&#34;INFO&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;AppenderRef</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/Root&gt;</span>
    <span class="nt">&lt;/Loggers&gt;</span>
<span class="nt">&lt;/Configuration&gt;</span>
</code></pre></div><h3 id="5注意事项">5.注意事项</h3>
<p>当同时存在配置文件<strong>logback.xml</strong>和<strong>application.properties</strong>时，假设存在以下配置：</p>
<div class="highlight"><pre class="chroma"><code class="language-XML" data-lang="XML"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;pattern&#34;</span> <span class="na">value=</span><span class="s">&#34;%d{yyyy-MM-dd HH:mm:ss.SSS} %c [%thread] %-5level ^ %msg%n&#34;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&#34;console&#34;</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;target&gt;</span>System.err<span class="nt">&lt;/target&gt;</span>
        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&#34;ch.qos.logback.classic.encoder.PatternLayoutEncoder&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>${pattern}<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&#34;INFO&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
    
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&#34;cn.hanna&#34;</span> <span class="na">level=</span><span class="s">&#34;info&#34;</span> <span class="na">additivity=</span><span class="s">&#34;false&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&#34;console&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">logging.pattern.console<span class="o">=</span>%d<span class="o">{</span>yyyy-MM-dd HH:mm:ss.SSS<span class="o">}</span> %c <span class="o">[</span>%thread<span class="o">]</span> %-5level %msg%n

logging.file.path<span class="o">=</span>d:/logs
logging.pattern.file<span class="o">=</span>%d<span class="o">{</span>yyyy-MM-dd HH:mm:ss.SSS<span class="o">}</span> %c <span class="o">[</span>%thread<span class="o">]</span> %-5level %msg%n
logging.charset.file<span class="o">=</span>UTF-8

logging.level.cn.hanna<span class="o">=</span>trace
</code></pre></div><p>此时，<strong>application.properties</strong>中的<strong>appender</strong>设置会被覆盖，但特定包的特定日志等级<strong>logging.level.cn.hanna=trace</strong>不会被覆盖，即使你在配置文件<strong>logback.xml</strong>中再次指定了<strong>cn.hanna</strong>的日志等级为<strong>INFO</strong>，<strong>SpringBoot</strong>会以<strong>application.properties</strong>为准。</p>
<p>很多规则可以通过一些简单的测试得到结论，不需要记忆太多。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-06-24</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/log/">Log</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/jwt_tutorial/" class="prev" rel="prev" title="JWT Tutorial"><i class="fas fa-angle-left fa-fw"></i>JWT Tutorial</a>
            <a href="/posts/hugo_blog/" class="next" rel="next" title="Hugo Blog">Hugo Blog<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">2phangx-dylan</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/mermaid/mermaid.min.css"><link rel="stylesheet" href="/css/408672.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/mermaid/mermaid.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"data":{"id-1":"\r\ngraph LR;\r\n\tA(log4j) --\u003e B(JUL) --\u003e C(JCL) --\u003e D(slf4j/slf4j-simple) --\u003e E(logback) --\u003e F(log4j2)\r"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
